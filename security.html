<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureWatch - Security Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .pulse-dot {
            animation: pulseDot 2s infinite;
        }
        
        @keyframes pulseDot {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .status-online { color: #10b981; }
        .status-offline { color: #ef4444; }
        .status-break { color: #f59e0b; }
        
        .incident-high { border-left: 4px solid #ef4444; }
        .incident-medium { border-left: 4px solid #f59e0b; }
        .incident-low { border-left: 4px solid #10b981; }
        
        .map-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        
        .guard-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .notification-badge {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-2px); }
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .activity-timeline {
            position: relative;
        }
        
        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }
        
        .activity-item {
            position: relative;
            padding-left: 50px;
            margin-bottom: 20px;
        }
        
        .activity-dot {
            position: absolute;
            left: 11px;
            top: 6px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg sidebar-transition transform -translate-x-full lg:translate-x-0">
        <div class="flex items-center justify-center h-16 bg-blue-600 text-white">
            <i class="fas fa-shield-alt text-2xl mr-2"></i>
            <h1 class="text-xl font-bold">SecureWatch</h1>
        </div>
        
        <nav class="mt-8 pb-24">
            <div class="px-4 space-y-2">
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt w-4 h-4 mr-3"></i>
                    Dashboard
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="guards">
                    <i class="fas fa-users w-4 h-4 mr-3"></i>
                    Guard Tracking
                    <span class="ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">8 Active</span>
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="incidents">
                    <i class="fas fa-exclamation-triangle w-4 h-4 mr-3"></i>
                    Incidents
                    <span class="ml-auto bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full notification-badge">3</span>
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="reports">
                    <i class="fas fa-chart-bar w-4 h-4 mr-3"></i>
                    Reports
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="zones">
                    <i class="fas fa-map-marked-alt w-4 h-4 mr-3"></i>
                    Security Zones
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="alerts">
                    <i class="fas fa-bell w-4 h-4 mr-3"></i>
                    Alerts
                    <span class="ml-auto bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">5</span>
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="users">
                    <i class="fas fa-users-cog w-4 h-4 mr-3"></i>
                    User Management
                    <span class="ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full" id="userCount">3</span>
                </a>
                
                <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-700 text-sm rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors" data-page="settings">
                    <i class="fas fa-cog w-4 h-4 mr-3"></i>
                    Settings
                </a>
            </div>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4 bg-white border-t border-gray-200">
            <div id="userProfile" class="bg-gray-100 rounded-lg p-3">
                <div class="flex items-center">
                    <div id="userAvatar" class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                        JD
                    </div>
                    <div class="ml-3">
                        <p id="userName" class="text-sm font-medium text-gray-900">John Doe</p>
                        <p id="userRole" class="text-xs text-gray-500">Security Manager</p>
                    </div>
                </div>
                <button onclick="logout()" class="mt-2 w-full text-left text-xs text-gray-600 hover:text-gray-900 transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Sign Out
                </button>
            </div>
            
            <!-- Login/Signup buttons when not authenticated -->
            <div id="authButtons" class="space-y-2 hidden">
                <button onclick="openModal('loginModal')" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In
                </button>
                <button onclick="openModal('signupModal')" class="w-full border border-blue-600 text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors">
                    <i class="fas fa-user-plus mr-2"></i>
                    Sign Up
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile sidebar overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden hidden"></div>

    <!-- Main Content -->
    <div class="lg:ml-64">
        <!-- Top Navigation -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center">
                    <button id="sidebarToggle" class="lg:hidden text-gray-600 hover:text-gray-900 mr-4">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 id="pageTitle" class="text-xl font-semibold text-gray-900">Dashboard</h2>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Search..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64">
                        <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                    </div>
                    
                    <div class="relative">
                        <button id="notificationBtn" class="relative text-gray-600 hover:text-gray-900">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                        </button>
                        
                        <!-- Notification Dropdown -->
                        <div id="notificationDropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
                                    <button id="markAllRead" class="text-sm text-blue-600 hover:text-blue-800">Mark all read</button>
                                </div>
                            </div>
                            
                            <div class="max-h-96 overflow-y-auto">
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-start">
                                        <div class="p-2 bg-red-100 rounded-lg mr-3">
                                            <i class="fas fa-exclamation-triangle text-red-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Security Breach Alert</p>
                                            <p class="text-xs text-gray-600">Unauthorized access detected in Zone A</p>
                                            <p class="text-xs text-gray-500 mt-1">5 minutes ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                                    </div>
                                </div>
                                
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-start">
                                        <div class="p-2 bg-yellow-100 rounded-lg mr-3">
                                            <i class="fas fa-user-clock text-yellow-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Guard Check-in Overdue</p>
                                            <p class="text-xs text-gray-600">Mike Johnson hasn't checked in for 45 minutes</p>
                                            <p class="text-xs text-gray-500 mt-1">45 minutes ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                    </div>
                                </div>
                                
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-start">
                                        <div class="p-2 bg-blue-100 rounded-lg mr-3">
                                            <i class="fas fa-video-slash text-blue-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Camera Offline</p>
                                            <p class="text-xs text-gray-600">Camera 12 in East Wing has gone offline</p>
                                            <p class="text-xs text-gray-500 mt-1">1 hour ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                    </div>
                                </div>
                                
                                <div class="notification-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer opacity-60">
                                    <div class="flex items-start">
                                        <div class="p-2 bg-green-100 rounded-lg mr-3">
                                            <i class="fas fa-check-circle text-green-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Patrol Completed</p>
                                            <p class="text-xs text-gray-600">Zone C patrol round completed successfully</p>
                                            <p class="text-xs text-gray-500 mt-1">2 hours ago</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="notification-item p-4 hover:bg-gray-50 cursor-pointer opacity-60">
                                    <div class="flex items-start">
                                        <div class="p-2 bg-gray-100 rounded-lg mr-3">
                                            <i class="fas fa-info-circle text-gray-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">System Update</p>
                                            <p class="text-xs text-gray-600">Security system updated to version 2.1.4</p>
                                            <p class="text-xs text-gray-500 mt-1">3 hours ago</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-4 border-t border-gray-200">
                                <button class="w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    View All Notifications
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button id="emergencyBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Emergency
                    </button>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="p-6">
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 fade-in">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-user-shield text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Guards</p>
                                <p class="text-2xl font-bold text-gray-900">8</p>
                                <p class="text-xs text-green-600">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    2 more than yesterday
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 fade-in">
                        <div class="flex items-center">
                            <div class="p-3 bg-red-100 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Open Incidents</p>
                                <p class="text-2xl font-bold text-gray-900">3</p>
                                <p class="text-xs text-red-600">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    1 new today
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 fade-in">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-map-marked-alt text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Security Zones</p>
                                <p class="text-2xl font-bold text-gray-900">12</p>
                                <p class="text-xs text-blue-600">
                                    <i class="fas fa-check mr-1"></i>
                                    All secured
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 fade-in">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-bell text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Alerts</p>
                                <p class="text-2xl font-bold text-gray-900">5</p>
                                <p class="text-xs text-yellow-600">
                                    <i class="fas fa-clock mr-1"></i>
                                    2 pending review
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Guard Locations Map -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Guard Locations</h3>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">View All</button>
                        </div>
                        <div class="map-container h-64 rounded-lg relative">
                            <!-- Simulated map with guard markers -->
                            <div class="guard-marker bg-green-500 pulse-dot" style="top: 20%; left: 30%;"></div>
                            <div class="guard-marker bg-green-500 pulse-dot" style="top: 40%; left: 60%;"></div>
                            <div class="guard-marker bg-green-500 pulse-dot" style="top: 60%; left: 25%;"></div>
                            <div class="guard-marker bg-green-500 pulse-dot" style="top: 30%; left: 75%;"></div>
                            <div class="guard-marker bg-yellow-500 pulse-dot" style="top: 70%; left: 50%;"></div>
                            <div class="guard-marker bg-green-500 pulse-dot" style="top: 15%; left: 80%;"></div>
                            
                            <!-- Map overlay info -->
                            <div class="absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg p-3">
                                <div class="flex items-center space-x-4 text-sm">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        <span>On Duty (7)</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                        <span>Break (1)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Recent Activity</h3>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">View All</button>
                        </div>
                        <div class="activity-timeline">
                            <div class="activity-item">
                                <div class="activity-dot bg-green-500"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Guard check-in completed</p>
                                    <p class="text-xs text-gray-500">Zone A - Building 1 • 2 minutes ago</p>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-dot bg-red-500"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Security incident reported</p>
                                    <p class="text-xs text-gray-500">Parking Lot B • 15 minutes ago</p>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-dot bg-blue-500"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Patrol route completed</p>
                                    <p class="text-xs text-gray-500">Perimeter Route • 32 minutes ago</p>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-dot bg-yellow-500"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Maintenance alert</p>
                                    <p class="text-xs text-gray-500">Camera 12 - East Wing • 1 hour ago</p>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-dot bg-green-500"></div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Shift change completed</p>
                                    <p class="text-xs text-gray-500">Night shift started • 2 hours ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Incident Trends Chart -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Incident Trends</h3>
                        <div class="chart-container">
                            <canvas id="incidentChart"></canvas>
                        </div>
                    </div>

                    <!-- Guard Performance Chart -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Guard Performance</h3>
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guards Page -->
            <div id="guardsPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Guard Tracking</h2>
                    <button id="addGuardBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Add Guard
                    </button>
                </div>

                <!-- Guard Status Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-user-check text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">On Duty</p>
                                <p class="text-2xl font-bold text-gray-900">7</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-coffee text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">On Break</p>
                                <p class="text-2xl font-bold text-gray-900">1</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-red-100 rounded-lg">
                                <i class="fas fa-user-times text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Off Duty</p>
                                <p class="text-2xl font-bold text-gray-900">4</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Guards List -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">All Guards</h3>
                            <div class="flex items-center space-x-4">
                                <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option>All Status</option>
                                    <option>On Duty</option>
                                    <option>On Break</option>
                                    <option>Off Duty</option>
                                </select>
                                <div class="relative">
                                    <input type="text" placeholder="Search guards..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guard</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shift</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Check-in</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="guardsTableBody">
                                <!-- Guards will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Incidents Page -->
            <div id="incidentsPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Incident Management</h2>
                    <button id="reportIncidentBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Report Incident
                    </button>
                </div>

                <!-- Incident Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-red-100 rounded-lg">
                                <i class="fas fa-exclamation-circle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">High Priority</p>
                                <p class="text-2xl font-bold text-gray-900">1</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Medium Priority</p>
                                <p class="text-2xl font-bold text-gray-900">2</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-info-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Low Priority</p>
                                <p class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-check-circle text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Resolved Today</p>
                                <p class="text-2xl font-bold text-gray-900">5</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Incidents List -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">Recent Incidents</h3>
                            <div class="flex items-center space-x-4">
                                <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option>All Priorities</option>
                                    <option>High</option>
                                    <option>Medium</option>
                                    <option>Low</option>
                                </select>
                                <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option>All Status</option>
                                    <option>Open</option>
                                    <option>In Progress</option>
                                    <option>Resolved</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="divide-y divide-gray-200" id="incidentsList">
                        <!-- Incidents will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reportsPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Security Reports</h2>
                    <button onclick="exportReport()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-download mr-2"></i>
                        Export Report
                    </button>
                </div>

                <!-- Report Filters -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Report Filters</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>Last 7 days</option>
                                <option>Last 30 days</option>
                                <option>Last 3 months</option>
                                <option>Custom range</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>All Reports</option>
                                <option>Incident Reports</option>
                                <option>Guard Performance</option>
                                <option>Zone Activity</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone</label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>All Zones</option>
                                <option>Zone A</option>
                                <option>Zone B</option>
                                <option>Zone C</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="generateReport()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Summary -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Weekly Summary</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Total Incidents</span>
                                <span class="font-semibold">12</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Resolved Incidents</span>
                                <span class="font-semibold text-green-600">10</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Average Response Time</span>
                                <span class="font-semibold">8 minutes</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Guard Efficiency</span>
                                <span class="font-semibold text-green-600">94%</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Zone Performance</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Zone A</span>
                                <div class="flex items-center">
                                    <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                                    </div>
                                    <span class="text-sm font-medium">95%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Zone B</span>
                                <div class="flex items-center">
                                    <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 78%"></div>
                                    </div>
                                    <span class="text-sm font-medium">78%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Zone C</span>
                                <div class="flex items-center">
                                    <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                                    </div>
                                    <span class="text-sm font-medium">92%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Zones Page -->
            <div id="zonesPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Security Zones</h2>
                    <button id="addZoneBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Add Zone
                    </button>
                </div>

                <!-- Zone Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Zone A</h3>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Secure</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Guards:</span>
                                <span class="font-medium">2 Active</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cameras:</span>
                                <span class="font-medium">8 Online</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Last Patrol:</span>
                                <span class="font-medium">15 min ago</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full text-blue-600 hover:text-blue-800 text-sm font-medium">View Details</button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Zone B</h3>
                            <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">Alert</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Guards:</span>
                                <span class="font-medium">1 Active</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cameras:</span>
                                <span class="font-medium">6 Online</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Last Patrol:</span>
                                <span class="font-medium">45 min ago</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full text-blue-600 hover:text-blue-800 text-sm font-medium">View Details</button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Zone C</h3>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Secure</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Guards:</span>
                                <span class="font-medium">3 Active</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cameras:</span>
                                <span class="font-medium">12 Online</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Last Patrol:</span>
                                <span class="font-medium">8 min ago</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full text-blue-600 hover:text-blue-800 text-sm font-medium">View Details</button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Parking</h3>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Secure</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Guards:</span>
                                <span class="font-medium">2 Active</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cameras:</span>
                                <span class="font-medium">15 Online</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Last Patrol:</span>
                                <span class="font-medium">22 min ago</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full text-blue-600 hover:text-blue-800 text-sm font-medium">View Details</button>
                    </div>
                </div>
            </div>

            <!-- Alerts Page -->
            <div id="alertsPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">System Alerts</h2>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-cog mr-2"></i>
                        Alert Settings
                    </button>
                </div>

                <!-- Alert Categories -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-red-100 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Critical Alerts</p>
                                <p class="text-2xl font-bold text-gray-900">2</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-exclamation-circle text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Warning Alerts</p>
                                <p class="text-2xl font-bold text-gray-900">3</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-info-circle text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Info Alerts</p>
                                <p class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alerts List -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Active Alerts</h3>
                    </div>
                    
                    <div class="divide-y divide-gray-200">
                        <div class="p-6 border-l-4 border-red-500">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start">
                                    <div class="p-2 bg-red-100 rounded-lg mr-4">
                                        <i class="fas fa-video-slash text-red-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-medium text-gray-900">Camera Offline</h4>
                                        <p class="text-gray-600">Camera 12 in East Wing has gone offline</p>
                                        <p class="text-sm text-gray-500 mt-1">Zone B • 5 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-lg hover:bg-blue-200 transition-colors">Investigate</button>
                                    <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm rounded-lg hover:bg-gray-200 transition-colors">Dismiss</button>
                                </div>
                            </div>
                        </div>

                        <div class="p-6 border-l-4 border-red-500">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start">
                                    <div class="p-2 bg-red-100 rounded-lg mr-4">
                                        <i class="fas fa-door-open text-red-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-medium text-gray-900">Unauthorized Access</h4>
                                        <p class="text-gray-600">Door sensor triggered in restricted area</p>
                                        <p class="text-sm text-gray-500 mt-1">Zone A • 12 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-lg hover:bg-blue-200 transition-colors">Investigate</button>
                                    <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm rounded-lg hover:bg-gray-200 transition-colors">Dismiss</button>
                                </div>
                            </div>
                        </div>

                        <div class="p-6 border-l-4 border-yellow-500">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start">
                                    <div class="p-2 bg-yellow-100 rounded-lg mr-4">
                                        <i class="fas fa-user-clock text-yellow-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-medium text-gray-900">Guard Check-in Overdue</h4>
                                        <p class="text-gray-600">Mike Johnson hasn't checked in for 45 minutes</p>
                                        <p class="text-sm text-gray-500 mt-1">Zone B • 45 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-lg hover:bg-blue-200 transition-colors">Contact</button>
                                    <button class="px-3 py-1 bg-gray-100 text-gray-800 text-sm rounded-lg hover:bg-gray-200 transition-colors">Dismiss</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Page -->
            <div id="usersPage" class="page-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">User Management</h2>
                    <button id="createUserBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>
                        Create User
                    </button>
                </div>

                <!-- User Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Users</p>
                                <p id="totalUsersCount" class="text-2xl font-bold text-gray-900">3</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-user-check text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Users</p>
                                <p id="activeUsersCount" class="text-2xl font-bold text-gray-900">2</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-lg">
                                <i class="fas fa-user-shield text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Admins</p>
                                <p id="adminUsersCount" class="text-2xl font-bold text-gray-900">1</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-user-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Pending</p>
                                <p id="pendingUsersCount" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users List -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">All Users</h3>
                            <div class="flex items-center space-x-4">
                                <select id="roleFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">All Roles</option>
                                    <option value="Super Admin">Super Admin</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Coordinator">Coordinator</option>
                                    <option value="Analyst">Analyst</option>
                                    <option value="Operator">Operator</option>
                                </select>
                                <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                </select>
                                <div class="relative">
                                    <input type="text" id="userSearch" placeholder="Search users..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Login</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="usersTableBody">
                                <!-- Users will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page-content hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">System Settings</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- General Settings -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">General Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">System Name</label>
                                <input type="text" value="SecureWatch System" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Time Zone</label>
                                <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option>UTC-5 (Eastern Time)</option>
                                    <option>UTC-6 (Central Time)</option>
                                    <option>UTC-7 (Mountain Time)</option>
                                    <option>UTC-8 (Pacific Time)</option>
                                </select>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="autoBackup" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="autoBackup" class="ml-2 block text-sm text-gray-700">Enable automatic backups</label>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Notification Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Email Notifications</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">SMS Alerts</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Push Notifications</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Security Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Timeout (minutes)</label>
                                <input type="number" value="30" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="twoFactor" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <label for="twoFactor" class="ml-2 block text-sm text-gray-700">Require two-factor authentication</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="auditLog" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <label for="auditLog" class="ml-2 block text-sm text-gray-700">Enable audit logging</label>
                            </div>
                        </div>
                    </div>

                    <!-- System Information -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">System Information</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Version</span>
                                <span class="text-sm font-medium">v2.1.4</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Last Update</span>
                                <span class="text-sm font-medium">March 15, 2024</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Database Size</span>
                                <span class="text-sm font-medium">2.4 GB</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Active Users</span>
                                <span class="text-sm font-medium">12</span>
                            </div>
                        </div>
                        <button class="mt-4 w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            Check for Updates
                        </button>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-4">
                    <button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Reset to Defaults
                    </button>
                    <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Save Changes
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Report Incident Modal -->
    <div id="reportIncidentModal" class="fixed inset-0 hidden" style="z-index: 9999;">
        <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50" onclick="closeModal('reportIncidentModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4" style="position: relative; z-index: 10000;">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="position: relative; z-index: 10001;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Report New Incident</h3>
                        <button onclick="closeModal('reportIncidentModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="incidentForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Incident Type</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select type...</option>
                                <option value="security_breach">Security Breach</option>
                                <option value="theft">Theft</option>
                                <option value="vandalism">Vandalism</option>
                                <option value="suspicious_activity">Suspicious Activity</option>
                                <option value="medical_emergency">Medical Emergency</option>
                                <option value="fire">Fire</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select priority...</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Location/Zone</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select location...</option>
                                <option value="zone_a">Zone A</option>
                                <option value="zone_b">Zone B</option>
                                <option value="zone_c">Zone C</option>
                                <option value="parking">Parking Area</option>
                                <option value="entrance">Main Entrance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reporting Guard</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select guard...</option>
                                <option value="john_smith">John Smith</option>
                                <option value="sarah_johnson">Sarah Johnson</option>
                                <option value="mike_davis">Mike Davis</option>
                                <option value="lisa_wilson">Lisa Wilson</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Incident Description</label>
                        <textarea rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Provide detailed description of the incident..." required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Actions Taken</label>
                        <textarea rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe any immediate actions taken..."></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Attach Evidence</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-600">Click to upload photos or documents</p>
                            <input type="file" multiple accept="image/*,.pdf,.doc,.docx" class="hidden">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('reportIncidentModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            Report Incident
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Emergency Modal -->
    <div id="emergencyModal" class="fixed inset-0 hidden" style="z-index: 9999;">
        <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50" onclick="closeModal('emergencyModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4" style="position: relative; z-index: 10000;">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-md w-full">
                <div class="p-6 text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Emergency Alert</h3>
                    <p class="text-gray-600 mb-6">This will trigger an immediate emergency response. Are you sure you want to proceed?</p>
                    
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeModal('emergencyModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button onclick="triggerEmergency()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            Confirm Emergency
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Guard Modal -->
    <div id="contactGuardModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('contactGuardModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-lg w-full" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Contact Guard</h3>
                        <button onclick="closeModal('contactGuardModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Guard Info -->
                    <div class="flex items-center mb-6 p-4 bg-gray-50 rounded-lg">
                        <div class="h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                            <span id="contactGuardAvatar" class="text-lg font-medium text-blue-600">JS</span>
                        </div>
                        <div>
                            <h4 id="contactGuardName" class="text-lg font-medium text-gray-900">John Smith</h4>
                            <p id="contactGuardLocation" class="text-sm text-gray-500">Zone A • Day Shift</p>
                        </div>
                    </div>
                    
                    <!-- Contact Options -->
                    <div class="space-y-3 mb-6">
                        <button onclick="initiateCall()" class="w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-phone mr-3"></i>
                            Call Guard
                            <span id="contactGuardPhone" class="ml-2 text-sm opacity-75">(555) 123-4567</span>
                        </button>
                        
                        <button onclick="sendQuickMessage()" class="w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-sms mr-3"></i>
                            Send Quick Message
                        </button>
                        
                        <button onclick="requestCheckIn()" class="w-full flex items-center justify-center px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-map-marker-alt mr-3"></i>
                            Request Check-in
                        </button>
                    </div>
                    
                    <!-- Custom Message -->
                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Send Custom Message</label>
                        <textarea id="customMessage" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your message here..."></textarea>
                        <button onclick="sendCustomMessage()" class="mt-3 w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-paper-plane mr-2"></i>
                            Send Message
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Guard Modal -->
    <div id="viewGuardModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('viewGuardModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Guard Details</h3>
                        <button onclick="closeModal('viewGuardModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Guard Profile Header -->
                    <div class="flex items-center mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
                        <div class="h-20 w-20 rounded-full bg-blue-100 flex items-center justify-center mr-6">
                            <span id="viewGuardAvatar" class="text-2xl font-bold text-blue-600">JS</span>
                        </div>
                        <div class="flex-1">
                            <h2 id="viewGuardName" class="text-2xl font-bold text-gray-900 mb-2">John Smith</h2>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span id="viewGuardId" class="bg-white px-3 py-1 rounded-full">ID: 001</span>
                                <span id="viewGuardStatus" class="px-3 py-1 rounded-full bg-green-100 text-green-800">On Duty</span>
                                <span id="viewGuardShift" class="bg-white px-3 py-1 rounded-full">Day Shift</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-500 mb-1">Current Location</div>
                            <div id="viewGuardLocation" class="text-lg font-semibold text-gray-900">Zone A</div>
                            <div class="text-sm text-gray-500 mt-1">Last Check-in: <span id="viewGuardCheckin">2 min ago</span></div>
                        </div>
                    </div>

                    <!-- Guard Information Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Personal Information -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-user text-blue-600 mr-2"></i>
                                Personal Information
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Full Name:</span>
                                    <span id="viewGuardFullName" class="font-medium text-gray-900">John Smith</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Employee ID:</span>
                                    <span id="viewGuardEmployeeId" class="font-medium text-gray-900">SEC-001</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Phone:</span>
                                    <span id="viewGuardPhone" class="font-medium text-gray-900">(555) 123-4567</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Email:</span>
                                    <span id="viewGuardEmail" class="font-medium text-gray-900">john.smith@securewatch.com</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Emergency Contact:</span>
                                    <span id="viewGuardEmergency" class="font-medium text-gray-900">(555) 987-6543</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Hire Date:</span>
                                    <span id="viewGuardHireDate" class="font-medium text-gray-900">Jan 15, 2023</span>
                                </div>
                            </div>
                        </div>

                        <!-- Work Information -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-briefcase text-blue-600 mr-2"></i>
                                Work Information
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Current Status:</span>
                                    <span id="viewGuardWorkStatus" class="px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full">On Duty</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Assigned Zone:</span>
                                    <span id="viewGuardZone" class="font-medium text-gray-900">Zone A</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Shift Schedule:</span>
                                    <span id="viewGuardSchedule" class="font-medium text-gray-900">Day Shift (6 AM - 6 PM)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Supervisor:</span>
                                    <span id="viewGuardSupervisor" class="font-medium text-gray-900">Sarah Johnson</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Performance Rating:</span>
                                    <div class="flex items-center">
                                        <div class="flex text-yellow-400 mr-2">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span class="text-sm text-gray-600">4.8/5</span>
                                    </div>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Hours (Month):</span>
                                    <span id="viewGuardHours" class="font-medium text-gray-900">168 hrs</span>
                                </div>
                            </div>
                        </div>

                        <!-- Certifications -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-certificate text-blue-600 mr-2"></i>
                                Certifications & Training
                            </h3>
                            <div class="space-y-3" id="viewGuardCertifications">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                                        <span class="text-gray-900">Security License</span>
                                    </div>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Valid</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-heart text-red-600 mr-2"></i>
                                        <span class="text-gray-900">First Aid/CPR</span>
                                    </div>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Valid</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-fire text-orange-600 mr-2"></i>
                                        <span class="text-gray-900">Fire Safety</span>
                                    </div>
                                    <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Expires Soon</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-fist-raised text-blue-600 mr-2"></i>
                                        <span class="text-gray-900">Defensive Tactics</span>
                                    </div>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Valid</span>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>
                                Recent Activity
                            </h3>
                            <div class="space-y-4" id="viewGuardActivity">
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">Completed patrol round</p>
                                        <p class="text-xs text-gray-500">Zone A • 2 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">Check-in completed</p>
                                        <p class="text-xs text-gray-500">Main entrance • 15 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">Incident report filed</p>
                                        <p class="text-xs text-gray-500">Parking area • 1 hour ago</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">Shift started</p>
                                        <p class="text-xs text-gray-500">Security office • 6 hours ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="mt-8 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-blue-600 mr-2"></i>
                            Performance Metrics (This Month)
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">98%</div>
                                <div class="text-sm text-gray-600">Attendance</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">24</div>
                                <div class="text-sm text-gray-600">Patrols Completed</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-yellow-600">3</div>
                                <div class="text-sm text-gray-600">Incidents Handled</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600">4.8</div>
                                <div class="text-sm text-gray-600">Avg Rating</div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-8 flex justify-end space-x-4">
                        <button onclick="contactGuard(document.getElementById('viewGuardModal').dataset.guardId)" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-phone mr-2"></i>
                            Contact Guard
                        </button>
                        <button onclick="editGuardFromView()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-edit mr-2"></i>
                            Edit Information
                        </button>
                        <button onclick="closeModal('viewGuardModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Guard Modal -->
    <div id="addGuardModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('addGuardModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Add New Guard</h3>
                        <button onclick="closeModal('addGuardModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="addGuardForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="addGuardName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter full name" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Employee ID</label>
                            <input type="text" id="addGuardId" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100" placeholder="Auto-generated" readonly>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Initial Status *</label>
                            <select id="addGuardStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select status...</option>
                                <option value="off_duty">Off Duty</option>
                                <option value="on_duty">On Duty</option>
                                <option value="on_break">On Break</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Zone *</label>
                            <select id="addGuardLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select zone...</option>
                                <option value="Zone A">Zone A</option>
                                <option value="Zone B">Zone B</option>
                                <option value="Zone C">Zone C</option>
                                <option value="Parking">Parking Area</option>
                                <option value="Entrance">Main Entrance</option>
                                <option value="Perimeter">Perimeter</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Shift Assignment *</label>
                            <select id="addGuardShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select shift...</option>
                                <option value="Day Shift">Day Shift (6 AM - 6 PM)</option>
                                <option value="Night Shift">Night Shift (6 PM - 6 AM)</option>
                                <option value="Morning Shift">Morning Shift (6 AM - 2 PM)</option>
                                <option value="Evening Shift">Evening Shift (2 PM - 10 PM)</option>
                                <option value="Overnight Shift">Overnight Shift (10 PM - 6 AM)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
                            <input type="tel" id="addGuardPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                            <input type="email" id="addGuardEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="guard@company.com" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                            <input type="tel" id="addGuardEmergency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 987-6543">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hire Date</label>
                            <input type="date" id="addGuardHireDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Supervisor</label>
                            <select id="addGuardSupervisor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select supervisor...</option>
                                <option value="Sarah Johnson">Sarah Johnson</option>
                                <option value="Mike Davis">Mike Davis</option>
                                <option value="Lisa Wilson">Lisa Wilson</option>
                                <option value="David Brown">David Brown</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Required Certifications</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="addCertSecurity" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Security License</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="addCertFirstAid" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">First Aid/CPR</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="addCertFireSafety" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Fire Safety</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="addCertDefensive" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Defensive Tactics</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
                        <textarea id="addGuardNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any additional information about the guard..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('addGuardModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>
                            Add Guard
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Incident Details Modal -->
    <div id="viewIncidentModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('viewIncidentModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Incident Details</h3>
                        <button onclick="closeModal('viewIncidentModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Incident Header -->
                    <div class="flex items-start justify-between mb-6 p-6 bg-gradient-to-r from-red-50 to-orange-50 rounded-xl">
                        <div class="flex-1">
                            <div class="flex items-center mb-3">
                                <h2 id="incidentDetailType" class="text-2xl font-bold text-gray-900 mr-4">Security Breach</h2>
                                <span id="incidentDetailPriority" class="px-3 py-1 bg-red-100 text-red-800 text-sm font-medium rounded-full">HIGH</span>
                                <span id="incidentDetailStatus" class="px-3 py-1 bg-red-100 text-red-800 text-sm font-medium rounded-full ml-2">OPEN</span>
                            </div>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span class="flex items-center">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span id="incidentDetailLocation">Zone A - Building 1</span>
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span id="incidentDetailTime">15 minutes ago</span>
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-user mr-1"></i>
                                    <span id="incidentDetailReporter">John Smith</span>
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-500 mb-1">Incident ID</div>
                            <div id="incidentDetailId" class="text-lg font-semibold text-gray-900">#INC-001</div>
                        </div>
                    </div>

                    <!-- Incident Information Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Incident Details -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                                Incident Information
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <p id="incidentDetailDescription" class="text-gray-900 bg-gray-50 p-3 rounded-lg">Unauthorized access detected in restricted area. Motion sensors triggered at 14:30. Security footage shows unidentified individual attempting to access server room.</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Actions Taken</label>
                                    <p id="incidentDetailActions" class="text-gray-900 bg-gray-50 p-3 rounded-lg">Security team dispatched immediately. Area secured and individual escorted off premises. Reviewing security footage for identification.</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Severity Level</label>
                                        <span id="incidentDetailSeverity" class="inline-flex px-2 py-1 bg-red-100 text-red-800 text-sm rounded-full">Critical</span>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Response Time</label>
                                        <span id="incidentDetailResponseTime" class="text-gray-900 font-medium">3 minutes</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Personnel Involved -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-users text-blue-600 mr-2"></i>
                                Personnel Involved
                            </h3>
                            <div class="space-y-4" id="incidentPersonnel">
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                        <span class="text-sm font-medium text-blue-600">JS</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">John Smith</p>
                                        <p class="text-xs text-gray-500">Reporting Officer • Zone A</p>
                                    </div>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Primary</span>
                                </div>
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                        <span class="text-sm font-medium text-blue-600">SJ</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Sarah Johnson</p>
                                        <p class="text-xs text-gray-500">Response Team • Zone B</p>
                                    </div>
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Support</span>
                                </div>
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                        <span class="text-sm font-medium text-blue-600">MD</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Mike Davis</p>
                                        <p class="text-xs text-gray-500">Supervisor • Security Office</p>
                                    </div>
                                    <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">Supervisor</span>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>
                                Incident Timeline
                            </h3>
                            <div class="space-y-4" id="incidentTimeline">
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-red-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Incident Reported</p>
                                        <p class="text-xs text-gray-500">Motion sensor triggered • 14:30</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Security Dispatched</p>
                                        <p class="text-xs text-gray-500">Response team notified • 14:31</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">On-Site Response</p>
                                        <p class="text-xs text-gray-500">Security arrived at location • 14:33</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Area Secured</p>
                                        <p class="text-xs text-gray-500">Individual escorted out • 14:35</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3"></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Investigation Started</p>
                                        <p class="text-xs text-gray-500">Reviewing security footage • 14:40</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Evidence & Attachments -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-paperclip text-blue-600 mr-2"></i>
                                Evidence & Attachments
                            </h3>
                            <div class="space-y-3" id="incidentEvidence">
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <i class="fas fa-video text-blue-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Security Footage</p>
                                        <p class="text-xs text-gray-500">Camera 12 - East Wing • 14:30-14:35</p>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800 text-sm">View</button>
                                </div>
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <i class="fas fa-camera text-green-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Scene Photos</p>
                                        <p class="text-xs text-gray-500">3 photos • Taken by John Smith</p>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800 text-sm">View</button>
                                </div>
                                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                    <i class="fas fa-file-alt text-orange-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Incident Report</p>
                                        <p class="text-xs text-gray-500">PDF • Generated automatically</p>
                                    </div>
                                    <button onclick="downloadIncidentReport()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Download</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-8 flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button onclick="updateIncidentStatus(document.getElementById('viewIncidentModal').dataset.incidentId)" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-edit mr-2"></i>
                                Update Status
                            </button>
                            <button onclick="assignIncident()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-user-plus mr-2"></i>
                                Assign Personnel
                            </button>
                            <button onclick="escalateIncident()" class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                <i class="fas fa-arrow-up mr-2"></i>
                                Escalate
                            </button>
                        </div>
                        <button onclick="closeModal('viewIncidentModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Incident Status Modal -->
    <div id="updateIncidentModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('updateIncidentModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-lg w-full" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Update Incident Status</h3>
                        <button onclick="closeModal('updateIncidentModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="updateIncidentForm" class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Status</label>
                        <div id="currentIncidentStatus" class="px-3 py-2 bg-gray-100 rounded-lg text-gray-900">Open</div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">New Status</label>
                        <select id="newIncidentStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Select new status...</option>
                            <option value="investigating">Investigating</option>
                            <option value="in_progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                        <select id="newIncidentPriority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Update Notes</label>
                        <textarea id="incidentUpdateNotes" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Add notes about this status update..." required></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('updateIncidentModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                            <i class="fas fa-save mr-2"></i>
                            Update Status
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('loginModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-md w-full" style="z-index: 60; position: relative;">
                <div class="p-8">
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <i class="fas fa-shield-alt text-4xl text-blue-600 mr-2"></i>
                            <h1 class="text-2xl font-bold text-gray-900">SecureWatch</h1>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-2">Welcome Back</h2>
                        <p class="text-gray-600">Sign in to your admin account</p>
                    </div>
                    
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username or Email</label>
                            <input type="text" id="loginUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter username or email" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter password" required>
                                <button type="button" onclick="togglePasswordVisibility('loginPassword')" class="absolute right-3 top-3 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <label class="flex items-center">
                                <input type="checkbox" id="rememberMe" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Remember me</span>
                            </label>
                            <button type="button" class="text-sm text-blue-600 hover:text-blue-800">Forgot password?</button>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            Sign In
                        </button>
                        
                        <div class="text-center">
                            <span class="text-gray-600">Don't have an account? </span>
                            <button type="button" onclick="switchToSignup()" class="text-blue-600 hover:text-blue-800 font-medium">Sign up</button>
                        </div>
                        
                        <!-- Demo Credentials -->
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <p class="text-sm font-medium text-gray-700 mb-2">Demo Credentials:</p>
                            <div class="text-xs text-gray-600 space-y-1">
                                <div><strong>Admin:</strong> admin / admin123</div>
                                <div><strong>Manager:</strong> manager / manager123</div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('signupModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-md w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-8">
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <i class="fas fa-shield-alt text-4xl text-blue-600 mr-2"></i>
                            <h1 class="text-2xl font-bold text-gray-900">SecureWatch</h1>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-2">Create Admin Account</h2>
                        <p class="text-gray-600">Join the security management team</p>
                    </div>
                    
                    <form id="signupForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="signupFullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your full name" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="signupUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Choose a username" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="signupEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your email" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select id="signupRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                <option value="">Select your role</option>
                                <option value="Manager">Security Manager</option>
                                <option value="Supervisor">Security Supervisor</option>
                                <option value="Coordinator">Security Coordinator</option>
                                <option value="Analyst">Security Analyst</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="signupPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Create a password" required>
                                <button type="button" onclick="togglePasswordVisibility('signupPassword')" class="absolute right-3 top-3 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="mt-2">
                                <div class="text-xs text-gray-600">Password strength: <span id="passwordStrength" class="font-medium">Weak</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
                                    <div id="passwordStrengthBar" class="bg-red-500 h-1 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                            <div class="relative">
                                <input type="password" id="signupConfirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Confirm your password" required>
                                <button type="button" onclick="togglePasswordVisibility('signupConfirmPassword')" class="absolute right-3 top-3 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="agreeTerms" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1" required>
                            <label for="agreeTerms" class="ml-2 text-sm text-gray-700">
                                I agree to the <a href="#" class="text-blue-600 hover:text-blue-800">Terms of Service</a> and <a href="#" class="text-blue-600 hover:text-blue-800">Privacy Policy</a>
                            </label>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i>
                            Create Account
                        </button>
                        
                        <div class="text-center">
                            <span class="text-gray-600">Already have an account? </span>
                            <button type="button" onclick="switchToLogin()" class="text-blue-600 hover:text-blue-800 font-medium">Sign in</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="createUserModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('createUserModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Create New User</h3>
                        <button onclick="closeModal('createUserModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="createUserForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="createUserFullName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter full name" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username *</label>
                            <input type="text" id="createUserUsername" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Choose username" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                            <input type="email" id="createUserEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter email address" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="createUserPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role *</label>
                            <select id="createUserRole" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select role...</option>
                                <option value="Manager">Security Manager</option>
                                <option value="Supervisor">Security Supervisor</option>
                                <option value="Coordinator">Security Coordinator</option>
                                <option value="Analyst">Security Analyst</option>
                                <option value="Operator">Security Operator</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                            <select id="createUserDepartment" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select department...</option>
                                <option value="Security Operations">Security Operations</option>
                                <option value="Incident Management">Incident Management</option>
                                <option value="Guard Management">Guard Management</option>
                                <option value="System Administration">System Administration</option>
                                <option value="Analytics">Analytics & Reporting</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Initial Password *</label>
                            <div class="relative">
                                <input type="password" id="createUserPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Create password" required>
                                <button type="button" onclick="togglePasswordVisibility('createUserPassword')" class="absolute right-3 top-2 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="mt-1">
                                <div class="text-xs text-gray-600">Password strength: <span id="createPasswordStrength" class="font-medium">Weak</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
                                    <div id="createPasswordStrengthBar" class="bg-red-500 h-1 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password *</label>
                            <div class="relative">
                                <input type="password" id="createUserConfirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Confirm password" required>
                                <button type="button" onclick="togglePasswordVisibility('createUserConfirmPassword')" class="absolute right-3 top-2 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Permissions</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permDashboard" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Dashboard Access</span>
                                    <p class="text-xs text-gray-500">View system overview</p>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permGuards" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Guard Management</span>
                                    <p class="text-xs text-gray-500">Manage security guards</p>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permIncidents" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Incident Management</span>
                                    <p class="text-xs text-gray-500">Handle security incidents</p>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permReports" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Reports & Analytics</span>
                                    <p class="text-xs text-gray-500">Generate and view reports</p>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permZones" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Zone Management</span>
                                    <p class="text-xs text-gray-500">Manage security zones</p>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="permUsers" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">User Management</span>
                                    <p class="text-xs text-gray-500">Manage system users</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Account Settings</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="requirePasswordChange" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <span class="ml-2 text-sm text-gray-700">Require password change on first login</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="sendWelcomeEmail" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <span class="ml-2 text-sm text-gray-700">Send welcome email with login credentials</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="enableTwoFactor" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Enable two-factor authentication</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                        <textarea id="createUserNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Additional notes about this user..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('createUserModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i>
                            Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('editUserModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Edit User</h3>
                        <button onclick="closeModal('editUserModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="editUserForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="editUserFullName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="editUserUsername" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="editUserEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                            <select id="editUserRole" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="Manager">Security Manager</option>
                                <option value="Supervisor">Security Supervisor</option>
                                <option value="Coordinator">Security Coordinator</option>
                                <option value="Analyst">Security Analyst</option>
                                <option value="Operator">Security Operator</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="editUserStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                            <select id="editUserDepartment" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Security Operations">Security Operations</option>
                                <option value="Incident Management">Incident Management</option>
                                <option value="Guard Management">Guard Management</option>
                                <option value="System Administration">System Administration</option>
                                <option value="Analytics">Analytics & Reporting</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reset Password</label>
                        <div class="flex items-center space-x-4">
                            <button type="button" id="resetPasswordBtn" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                <i class="fas fa-key mr-2"></i>
                                Generate New Password
                            </button>
                            <label class="flex items-center">
                                <input type="checkbox" id="forcePasswordChange" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Force password change on next login</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                        <textarea id="editUserNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('editUserModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete User Confirmation Modal -->
    <div id="deleteUserModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('deleteUserModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-md w-full" style="z-index: 60; position: relative;">
                <div class="p-6 text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Delete User</h3>
                    <p class="text-gray-600 mb-2">Are you sure you want to delete <span id="deleteUserName" class="font-medium"></span>?</p>
                    <p class="text-sm text-gray-500 mb-6">This action cannot be undone. All user data and access will be permanently removed.</p>
                    
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeModal('deleteUserModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button id="confirmDeleteUser" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash mr-2"></i>
                            Delete User
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Zone Modal -->
    <div id="addZoneModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('addZoneModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Add New Security Zone</h3>
                        <button onclick="closeModal('addZoneModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="addZoneForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone Name *</label>
                            <input type="text" id="addZoneName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Zone D, East Wing" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone Type *</label>
                            <select id="addZoneType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select type...</option>
                                <option value="Building">Building</option>
                                <option value="Parking">Parking Area</option>
                                <option value="Perimeter">Perimeter</option>
                                <option value="Entrance">Entrance/Exit</option>
                                <option value="Storage">Storage Area</option>
                                <option value="Office">Office Space</option>
                                <option value="Warehouse">Warehouse</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Security Level *</label>
                            <select id="addZoneSecurityLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select level...</option>
                                <option value="High">High Security</option>
                                <option value="Medium">Medium Security</option>
                                <option value="Low">Low Security</option>
                                <option value="Restricted">Restricted Access</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Initial Status *</label>
                            <select id="addZoneStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select status...</option>
                                <option value="Secure">Secure</option>
                                <option value="Alert">Alert</option>
                                <option value="Maintenance">Under Maintenance</option>
                                <option value="Offline">Offline</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Guards</label>
                            <input type="number" id="addZoneGuards" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0" min="0" max="10">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cameras</label>
                            <input type="number" id="addZoneCameras" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0" min="0" max="50">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Access Points</label>
                            <input type="number" id="addZoneAccessPoints" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0" min="0" max="20">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Zone Supervisor</label>
                        <select id="addZoneSupervisor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select supervisor...</option>
                            <option value="Sarah Johnson">Sarah Johnson</option>
                            <option value="Mike Davis">Mike Davis</option>
                            <option value="Lisa Wilson">Lisa Wilson</option>
                            <option value="David Brown">David Brown</option>
                            <option value="Emma Taylor">Emma Taylor</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Security Features</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureCCTV" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">CCTV Monitoring</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureAccessControl" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Access Control</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureMotionSensors" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Motion Sensors</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureAlarmSystem" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Alarm System</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureFireSafety" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Fire Safety</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="featureEmergencyExit" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Emergency Exits</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Patrol Frequency</label>
                            <select id="addZonePatrolFreq" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select frequency...</option>
                                <option value="Every 15 minutes">Every 15 minutes</option>
                                <option value="Every 30 minutes">Every 30 minutes</option>
                                <option value="Every hour">Every hour</option>
                                <option value="Every 2 hours">Every 2 hours</option>
                                <option value="Every 4 hours">Every 4 hours</option>
                                <option value="Daily">Daily</option>
                                <option value="As needed">As needed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select id="addZonePriority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select priority...</option>
                                <option value="Critical">Critical</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Zone Description</label>
                        <textarea id="addZoneDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the zone, its purpose, and any special security requirements..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Operating Hours</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">From</label>
                                <input type="time" id="addZoneHoursFrom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="06:00">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">To</label>
                                <input type="time" id="addZoneHoursTo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="22:00">
                            </div>
                        </div>
                        <label class="flex items-center mt-2">
                            <input type="checkbox" id="addZone24Hours" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">24/7 Operation</span>
                        </label>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
                        <textarea id="addZoneInstructions" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any special security protocols, access restrictions, or emergency procedures..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('addZoneModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>
                            Create Zone
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Zone Details Modal -->
    <div id="viewZoneModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('viewZoneModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Zone Details</h3>
                        <button onclick="closeModal('viewZoneModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Zone Header -->
                    <div class="flex items-center mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
                        <div class="h-20 w-20 rounded-full bg-blue-100 flex items-center justify-center mr-6">
                            <i class="fas fa-map-marked-alt text-3xl text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <h2 id="viewZoneName" class="text-2xl font-bold text-gray-900 mb-2">Zone A</h2>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span id="viewZoneId" class="bg-white px-3 py-1 rounded-full">ZONE-001</span>
                                <span id="viewZoneStatus" class="px-3 py-1 rounded-full bg-green-100 text-green-800">Secure</span>
                                <span id="viewZoneType" class="bg-white px-3 py-1 rounded-full">Building</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-500 mb-1">Security Level</div>
                            <div id="viewZoneSecurityLevel" class="text-lg font-semibold text-gray-900">High</div>
                            <div class="text-sm text-gray-500 mt-1">Priority: <span id="viewZonePriority" class="px-2 py-1 bg-yellow-100 text-yellow-800 text-sm rounded-full">Medium</span></div>
                        </div>
                    </div>

                    <!-- Zone Information Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Resource Information -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-users text-blue-600 mr-2"></i>
                                Resource Allocation
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-user-shield text-green-600 mr-3"></i>
                                        <span class="text-gray-900">Active Guards</span>
                                    </div>
                                    <span id="viewZoneGuards" class="text-lg font-semibold text-gray-900">2</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-video text-blue-600 mr-3"></i>
                                        <span class="text-gray-900">Security Cameras</span>
                                    </div>
                                    <span id="viewZoneCameras" class="text-lg font-semibold text-gray-900">8</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-door-open text-purple-600 mr-3"></i>
                                        <span class="text-gray-900">Access Points</span>
                                    </div>
                                    <span id="viewZoneAccessPoints" class="text-lg font-semibold text-gray-900">3</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-walking text-orange-600 mr-3"></i>
                                        <span class="text-gray-900">Last Patrol</span>
                                    </div>
                                    <span id="viewZoneLastPatrol" class="text-sm font-medium text-gray-900">15 min ago</span>
                                </div>
                            </div>
                        </div>

                        <!-- Management Information -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-cog text-blue-600 mr-2"></i>
                                Management Details
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Zone Supervisor:</span>
                                    <span id="viewZoneSupervisor" class="font-medium text-gray-900">Sarah Johnson</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Patrol Frequency:</span>
                                    <span id="viewZonePatrolFreq" class="font-medium text-gray-900">Every 30 minutes</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Operating Hours:</span>
                                    <span class="font-medium text-gray-900">24/7</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Emergency Protocol:</span>
                                    <span class="font-medium text-green-600">Active</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Backup Systems:</span>
                                    <span class="font-medium text-green-600">Operational</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Last Maintenance:</span>
                                    <span class="font-medium text-gray-900">2 days ago</span>
                                </div>
                            </div>
                        </div>

                        <!-- Security Features -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-shield-alt text-blue-600 mr-2"></i>
                                Security Features
                            </h3>
                            <div class="space-y-3" id="viewZoneFeatures">
                                <!-- Features will be populated dynamically -->
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>
                                Recent Activity
                            </h3>
                            <div class="space-y-4" id="viewZoneActivity">
                                <!-- Activity will be populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Zone Description -->
                    <div class="mt-8 bg-white border border-gray-200 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                            Zone Information
                        </h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-2">Description</h4>
                                <p id="viewZoneDescription" class="text-gray-900 bg-gray-50 p-3 rounded-lg">Main office building with executive offices and conference rooms</p>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-2">Special Instructions</h4>
                                <p id="viewZoneInstructions" class="text-gray-900 bg-gray-50 p-3 rounded-lg">No special instructions</p>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="mt-8 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-blue-600 mr-2"></i>
                            Performance Metrics (This Month)
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div id="zoneUptime" class="text-2xl font-bold text-green-600">98%</div>
                                <div class="text-sm text-gray-600">System Uptime</div>
                            </div>
                            <div class="text-center">
                                <div id="zoneIncidents" class="text-2xl font-bold text-blue-600">2</div>
                                <div class="text-sm text-gray-600">Incidents</div>
                            </div>
                            <div class="text-center">
                                <div id="zoneResponseTime" class="text-2xl font-bold text-yellow-600">5 min</div>
                                <div class="text-sm text-gray-600">Avg Response Time</div>
                            </div>
                            <div class="text-center">
                                <div id="zoneEfficiency" class="text-2xl font-bold text-purple-600">94%</div>
                                <div class="text-sm text-gray-600">Security Efficiency</div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-8 flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button onclick="editZoneFromView()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-edit mr-2"></i>
                                Edit Zone
                            </button>
                            <button onclick="generateZoneReport()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-chart-bar mr-2"></i>
                                Generate Report
                            </button>
                            <button onclick="schedulePatrol()" class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                <i class="fas fa-route mr-2"></i>
                                Schedule Patrol
                            </button>
                        </div>
                        <button onclick="closeModal('viewZoneModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Zone Modal -->
    <div id="editZoneModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('editZoneModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Edit Security Zone</h3>
                        <button onclick="closeModal('editZoneModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="editZoneForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone Name *</label>
                            <input type="text" id="editZoneName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone Type *</label>
                            <select id="editZoneType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="Building">Building</option>
                                <option value="Parking">Parking Area</option>
                                <option value="Perimeter">Perimeter</option>
                                <option value="Entrance">Entrance/Exit</option>
                                <option value="Storage">Storage Area</option>
                                <option value="Office">Office Space</option>
                                <option value="Warehouse">Warehouse</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Security Level *</label>
                            <select id="editZoneSecurityLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="High">High Security</option>
                                <option value="Medium">Medium Security</option>
                                <option value="Low">Low Security</option>
                                <option value="Restricted">Restricted Access</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                            <select id="editZoneStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="Secure">Secure</option>
                                <option value="Alert">Alert</option>
                                <option value="Maintenance">Under Maintenance</option>
                                <option value="Offline">Offline</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Guards</label>
                            <input type="number" id="editZoneGuards" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="10">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cameras</label>
                            <input type="number" id="editZoneCameras" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="50">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Access Points</label>
                            <input type="number" id="editZoneAccessPoints" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="20">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Zone Supervisor</label>
                        <select id="editZoneSupervisor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select supervisor...</option>
                            <option value="Sarah Johnson">Sarah Johnson</option>
                            <option value="Mike Davis">Mike Davis</option>
                            <option value="Lisa Wilson">Lisa Wilson</option>
                            <option value="David Brown">David Brown</option>
                            <option value="Emma Taylor">Emma Taylor</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Security Features</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureCCTV" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">CCTV Monitoring</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureAccessControl" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Access Control</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureMotionSensors" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Motion Sensors</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureAlarmSystem" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Alarm System</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureFireSafety" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Fire Safety</span>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="editFeatureEmergencyExit" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-3">
                                    <span class="text-sm font-medium text-gray-700">Emergency Exits</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Patrol Frequency</label>
                            <select id="editZonePatrolFreq" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Every 15 minutes">Every 15 minutes</option>
                                <option value="Every 30 minutes">Every 30 minutes</option>
                                <option value="Every hour">Every hour</option>
                                <option value="Every 2 hours">Every 2 hours</option>
                                <option value="Every 4 hours">Every 4 hours</option>
                                <option value="Daily">Daily</option>
                                <option value="As needed">As needed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select id="editZonePriority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Critical">Critical</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Zone Description</label>
                        <textarea id="editZoneDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the zone, its purpose, and any special security requirements..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Operating Hours</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">From</label>
                                <input type="time" id="editZoneHoursFrom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">To</label>
                                <input type="time" id="editZoneHoursTo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <label class="flex items-center mt-2">
                            <input type="checkbox" id="editZone24Hours" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">24/7 Operation</span>
                        </label>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
                        <textarea id="editZoneInstructions" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any special security protocols, access restrictions, or emergency procedures..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('editZoneModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Guard Confirmation Modal -->
    <div id="deleteGuardModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('deleteGuardModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-md w-full" style="z-index: 60; position: relative;">
                <div class="p-6 text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Delete Guard</h3>
                    <p class="text-gray-600 mb-2">Are you sure you want to delete <span id="deleteGuardName" class="font-medium"></span>?</p>
                    <p class="text-sm text-gray-500 mb-6">This action cannot be undone. All guard data and history will be permanently removed.</p>
                    
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeModal('deleteGuardModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button id="confirmDeleteGuard" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash mr-2"></i>
                            Delete Guard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Guard Modal -->
    <div id="editGuardModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal('editGuardModal')"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto" style="z-index: 60; position: relative;">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Edit Guard Information</h3>
                        <button onclick="closeModal('editGuardModal')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="editGuardForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="editGuardName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Employee ID</label>
                            <input type="text" id="editGuardId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="editGuardStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="on_duty">On Duty</option>
                                <option value="on_break">On Break</option>
                                <option value="off_duty">Off Duty</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Zone</label>
                            <select id="editGuardLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="Zone A">Zone A</option>
                                <option value="Zone B">Zone B</option>
                                <option value="Zone C">Zone C</option>
                                <option value="Parking">Parking Area</option>
                                <option value="Entrance">Main Entrance</option>
                                <option value="Perimeter">Perimeter</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Shift</label>
                            <select id="editGuardShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="Day Shift">Day Shift (6 AM - 6 PM)</option>
                                <option value="Night Shift">Night Shift (6 PM - 6 AM)</option>
                                <option value="Morning Shift">Morning Shift (6 AM - 2 PM)</option>
                                <option value="Evening Shift">Evening Shift (2 PM - 10 PM)</option>
                                <option value="Overnight Shift">Overnight Shift (10 PM - 6 AM)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="editGuardPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="editGuardEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="guard@company.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                            <input type="tel" id="editGuardEmergency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 987-6543">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Certifications</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="certSecurity" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Security License</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="certFirstAid" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">First Aid/CPR</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="certFireSafety" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Fire Safety</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="certDefensive" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Defensive Tactics</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                        <textarea id="editGuardNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Additional notes about the guard..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="closeModal('editGuardModal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Authentication state
        let currentUser = null;
        let isAuthenticated = false;

        // Sample admin users (in real app, this would be server-side)
        const adminUsers = [
            {
                id: 1,
                username: 'admin',
                email: 'admin@securewatch.com',
                password: 'admin123', // In real app, this would be hashed
                fullName: 'System Administrator',
                role: 'Super Admin',
                avatar: 'SA',
                status: 'active',
                department: 'System Administration',
                lastLogin: '2024-03-15 09:30',
                createdAt: '2024-01-01',
                permissions: ['dashboard', 'guards', 'incidents', 'reports', 'zones', 'users', 'settings']
            },
            {
                id: 2,
                username: 'manager',
                email: 'manager@securewatch.com',
                password: 'manager123',
                fullName: 'Security Manager',
                role: 'Manager',
                avatar: 'SM',
                status: 'active',
                department: 'Security Operations',
                lastLogin: '2024-03-14 16:45',
                createdAt: '2024-01-15',
                permissions: ['dashboard', 'guards', 'incidents', 'reports', 'zones']
            },
            {
                id: 3,
                username: 'analyst',
                email: 'analyst@securewatch.com',
                password: 'analyst123',
                fullName: 'Security Analyst',
                role: 'Analyst',
                avatar: 'SA',
                status: 'active',
                department: 'Analytics',
                lastLogin: '2024-03-13 14:20',
                createdAt: '2024-02-01',
                permissions: ['dashboard', 'reports', 'incidents']
            }
        ];

        // Sample data
        const zones = [
            { 
                id: 1, 
                name: 'Zone A', 
                type: 'Building',
                status: 'Secure', 
                guards: 2, 
                cameras: 8, 
                accessPoints: 3,
                lastPatrol: '15 min ago',
                securityLevel: 'High',
                supervisor: 'Sarah Johnson',
                description: 'Main office building with executive offices and conference rooms',
                patrolFreq: 'Every 30 minutes',
                priority: 'High'
            },
            { 
                id: 2, 
                name: 'Zone B', 
                type: 'Warehouse',
                status: 'Alert', 
                guards: 1, 
                cameras: 6, 
                accessPoints: 2,
                lastPatrol: '45 min ago',
                securityLevel: 'Medium',
                supervisor: 'Mike Davis',
                description: 'Storage and distribution warehouse',
                patrolFreq: 'Every hour',
                priority: 'Medium'
            },
            { 
                id: 3, 
                name: 'Zone C', 
                type: 'Office',
                status: 'Secure', 
                guards: 3, 
                cameras: 12, 
                accessPoints: 4,
                lastPatrol: '8 min ago',
                securityLevel: 'Medium',
                supervisor: 'Lisa Wilson',
                description: 'Employee work areas and meeting rooms',
                patrolFreq: 'Every 45 minutes',
                priority: 'Medium'
            },
            { 
                id: 4, 
                name: 'Parking', 
                type: 'Parking',
                status: 'Secure', 
                guards: 2, 
                cameras: 15, 
                accessPoints: 6,
                lastPatrol: '22 min ago',
                securityLevel: 'Low',
                supervisor: 'David Brown',
                description: 'Employee and visitor parking areas',
                patrolFreq: 'Every 2 hours',
                priority: 'Low'
            }
        ];

        const guards = [
            { id: 1, name: 'John Smith', status: 'on_duty', location: 'Zone A', shift: 'Day Shift', lastCheckin: '2 min ago', avatar: 'JS' },
            { id: 2, name: 'Sarah Johnson', status: 'on_duty', location: 'Zone B', shift: 'Day Shift', lastCheckin: '5 min ago', avatar: 'SJ' },
            { id: 3, name: 'Mike Davis', status: 'on_break', location: 'Zone C', shift: 'Day Shift', lastCheckin: '45 min ago', avatar: 'MD' },
            { id: 4, name: 'Lisa Wilson', status: 'on_duty', location: 'Parking', shift: 'Day Shift', lastCheckin: '1 min ago', avatar: 'LW' },
            { id: 5, name: 'David Brown', status: 'on_duty', location: 'Zone A', shift: 'Day Shift', lastCheckin: '8 min ago', avatar: 'DB' },
            { id: 6, name: 'Emma Taylor', status: 'on_duty', location: 'Zone B', shift: 'Day Shift', lastCheckin: '3 min ago', avatar: 'ET' },
            { id: 7, name: 'James Wilson', status: 'on_duty', location: 'Zone C', shift: 'Day Shift', lastCheckin: '12 min ago', avatar: 'JW' },
            { id: 8, name: 'Maria Garcia', status: 'on_duty', location: 'Entrance', shift: 'Day Shift', lastCheckin: '6 min ago', avatar: 'MG' }
        ];

        const incidents = [
            {
                id: 1,
                type: 'Security Breach',
                priority: 'high',
                location: 'Zone A - Building 1',
                reporter: 'John Smith',
                time: '15 minutes ago',
                status: 'open',
                description: 'Unauthorized access detected in restricted area'
            },
            {
                id: 2,
                type: 'Suspicious Activity',
                priority: 'medium',
                location: 'Parking Lot B',
                reporter: 'Sarah Johnson',
                time: '32 minutes ago',
                status: 'investigating',
                description: 'Individual loitering near vehicles'
            },
            {
                id: 3,
                type: 'Equipment Malfunction',
                priority: 'medium',
                location: 'Zone C - Camera 12',
                reporter: 'System Alert',
                time: '1 hour ago',
                status: 'open',
                description: 'Security camera offline'
            }
        ];

        // DOM elements
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const pageTitle = document.getElementById('pageTitle');
        const navItems = document.querySelectorAll('.nav-item');
        const pageContents = document.querySelectorAll('.page-content');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthenticationStatus();
            initializeCharts();
            renderGuards();
            renderIncidents();
            renderUsers();
            renderZones();
            updateUserStats();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle
            sidebarToggle.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);

            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.dataset.page;
                    navigateToPage(page);
                });
            });

            // Modal triggers
            document.getElementById('reportIncidentBtn').addEventListener('click', () => {
                openModal('reportIncidentModal');
            });

            document.getElementById('addGuardBtn').addEventListener('click', () => {
                openAddGuardModal();
            });

            document.getElementById('createUserBtn').addEventListener('click', () => {
                openCreateUserModal();
            });

            document.getElementById('addZoneBtn').addEventListener('click', () => {
                openAddZoneModal();
            });

            document.getElementById('emergencyBtn').addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Emergency button clicked');
                openModal('emergencyModal');
            });

            // Notification bell functionality
            document.getElementById('notificationBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleNotificationDropdown();
            });

            document.getElementById('markAllRead').addEventListener('click', markAllNotificationsRead);

            // Close notification dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('notificationDropdown');
                const btn = document.getElementById('notificationBtn');
                if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });

            // Emergency modal confirm button
            document.getElementById('confirmDeleteGuard').addEventListener('click', () => {
                // This will be handled by the onclick attribute set dynamically
            });

            // Form submissions
            document.getElementById('incidentForm').addEventListener('submit', handleIncidentSubmission);
            document.getElementById('addGuardForm').addEventListener('submit', handleAddGuard);
            document.getElementById('editGuardForm').addEventListener('submit', handleGuardEdit);
            document.getElementById('updateIncidentForm').addEventListener('submit', handleIncidentStatusUpdate);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('createUserForm').addEventListener('submit', handleCreateUser);
            document.getElementById('editUserForm').addEventListener('submit', handleEditUser);
            document.getElementById('addZoneForm').addEventListener('submit', handleAddZone);
            document.getElementById('editZoneForm').addEventListener('submit', handleEditZone);
            
            // Password strength checkers
            document.getElementById('signupPassword').addEventListener('input', checkPasswordStrength);
            document.getElementById('createUserPassword').addEventListener('input', checkCreatePasswordStrength);
            
            // User search and filters
            document.getElementById('userSearch').addEventListener('input', filterUsers);
            document.getElementById('roleFilter').addEventListener('change', filterUsers);
            document.getElementById('statusFilter').addEventListener('change', filterUsers);
        }

        // Sidebar functions
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }

        function closeSidebar() {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        }

        // Navigation
        function navigateToPage(page) {
            // Update active nav item
            navItems.forEach(item => {
                item.classList.remove('active', 'bg-blue-50', 'text-blue-600');
                item.classList.add('text-gray-700');
            });
            
            const activeItem = document.querySelector(`[data-page="${page}"]`);
            if (activeItem) {
                activeItem.classList.add('active', 'bg-blue-50', 'text-blue-600');
                activeItem.classList.remove('text-gray-700');
            }

            // Hide all pages
            pageContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected page
            const targetPage = document.getElementById(`${page}Page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            }

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                guards: 'Guard Tracking',
                incidents: 'Incident Management',
                reports: 'Security Reports',
                zones: 'Security Zones',
                alerts: 'System Alerts',
                users: 'User Management',
                settings: 'System Settings'
            };
            pageTitle.textContent = titles[page] || 'Dashboard';

            // Close sidebar on mobile
            if (window.innerWidth < 1024) {
                closeSidebar();
            }
        }

        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'block';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.zIndex = '9999';
                document.body.style.overflow = 'hidden';
                console.log(`Opening modal: ${modalId}`);
            } else {
                console.error(`Modal not found: ${modalId}`);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                console.log(`Closing modal: ${modalId}`);
            }
        }

        // Render guards table
        function renderGuards() {
            const tbody = document.getElementById('guardsTableBody');
            if (!tbody) return;

            tbody.innerHTML = guards.map(guard => {
                const statusClass = guard.status === 'on_duty' ? 'status-online' : 
                                  guard.status === 'on_break' ? 'status-break' : 'status-offline';
                const statusText = guard.status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                const statusBg = guard.status === 'on_duty' ? 'bg-green-100 text-green-800' : 
                               guard.status === 'on_break' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-sm font-medium text-blue-600">${guard.avatar}</span>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${guard.name}</div>
                                    <div class="text-sm text-gray-500">ID: ${guard.id.toString().padStart(3, '0')}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusBg}">
                                ${statusText}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${guard.location}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${guard.shift}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${guard.lastCheckin}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="viewGuard(${guard.id})" class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                            <button onclick="contactGuard(${guard.id})" class="text-green-600 hover:text-green-900 mr-3">Contact</button>
                            <button onclick="editGuard(${guard.id})" class="text-gray-600 hover:text-gray-900 mr-3">Edit</button>
                            <button onclick="deleteGuard(${guard.id})" class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Render incidents
        function renderIncidents() {
            const container = document.getElementById('incidentsList');
            if (!container) return;

            container.innerHTML = incidents.map(incident => {
                const priorityClass = incident.priority === 'high' ? 'incident-high' : 
                                    incident.priority === 'medium' ? 'incident-medium' : 'incident-low';
                const priorityBg = incident.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                 incident.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                const statusBg = incident.status === 'open' ? 'bg-red-100 text-red-800' : 
                               incident.status === 'investigating' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';

                return `
                    <div class="p-6 ${priorityClass}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <h4 class="text-lg font-medium text-gray-900 mr-3">${incident.type}</h4>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${priorityBg}">${incident.priority.toUpperCase()}</span>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${statusBg} ml-2">${incident.status.toUpperCase()}</span>
                                </div>
                                <p class="text-gray-600 mb-2">${incident.description}</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span class="mr-4">${incident.location}</span>
                                    <i class="fas fa-user mr-1"></i>
                                    <span class="mr-4">Reported by ${incident.reporter}</span>
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>${incident.time}</span>
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="viewIncidentDetails(${incident.id})" class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-lg hover:bg-blue-200 transition-colors">
                                    View Details
                                </button>
                                <button onclick="updateIncidentStatus(${incident.id})" class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-lg hover:bg-green-200 transition-colors">
                                    Update Status
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize charts
        function initializeCharts() {
            // Incident trends chart
            const incidentCtx = document.getElementById('incidentChart');
            if (incidentCtx) {
                new Chart(incidentCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Incidents',
                            data: [2, 1, 4, 2, 3, 1, 2],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#f3f4f6'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }

            // Guard performance chart
            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                new Chart(performanceCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Excellent', 'Good', 'Average'],
                        datasets: [{
                            data: [5, 2, 1],
                            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Handle incident form submission
        function handleIncidentSubmission(e) {
            e.preventDefault();
            
            // Simulate form submission
            setTimeout(() => {
                closeModal('reportIncidentModal');
                showNotification('Incident reported successfully!', 'success');
                
                // Add new incident to the list (simulation)
                const newIncident = {
                    id: incidents.length + 1,
                    type: 'New Incident',
                    priority: 'medium',
                    location: 'Zone A',
                    reporter: 'Current User',
                    time: 'Just now',
                    status: 'open',
                    description: 'New incident reported via system'
                };
                incidents.unshift(newIncident);
                renderIncidents();
            }, 1000);
        }

        // Open add guard modal with auto-generated ID
        function openAddGuardModal() {
            // Generate next available ID
            const nextId = Math.max(...guards.map(g => g.id)) + 1;
            document.getElementById('addGuardId').value = nextId.toString().padStart(3, '0');
            
            // Set default hire date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('addGuardHireDate').value = today;
            
            // Clear all form fields
            document.getElementById('addGuardForm').reset();
            document.getElementById('addGuardId').value = nextId.toString().padStart(3, '0');
            document.getElementById('addGuardHireDate').value = today;
            
            openModal('addGuardModal');
        }

        // Handle add guard form submission
        function handleAddGuard(e) {
            e.preventDefault();
            
            // Get form data
            const name = document.getElementById('addGuardName').value;
            const status = document.getElementById('addGuardStatus').value;
            const location = document.getElementById('addGuardLocation').value;
            const shift = document.getElementById('addGuardShift').value;
            const phone = document.getElementById('addGuardPhone').value;
            const email = document.getElementById('addGuardEmail').value;
            
            // Generate avatar initials
            const nameParts = name.split(' ');
            const avatar = nameParts.map(part => part.charAt(0)).join('').toUpperCase();
            
            // Create new guard object
            const newGuard = {
                id: Math.max(...guards.map(g => g.id)) + 1,
                name: name,
                status: status,
                location: location,
                shift: shift,
                lastCheckin: status === 'on_duty' ? 'Just now' : 'Not checked in',
                avatar: avatar,
                phone: phone,
                email: email
            };
            
            // Add to guards array
            guards.push(newGuard);
            
            // Simulate form submission delay
            setTimeout(() => {
                closeModal('addGuardModal');
                showNotification(`${name} has been added successfully!`, 'success');
                
                // Re-render guards table if visible
                const guardsPage = document.getElementById('guardsPage');
                if (guardsPage && !guardsPage.classList.contains('hidden')) {
                    renderGuards();
                }
                
                // Update dashboard stats
                updateDashboardStats();
            }, 500);
        }

        // Handle guard edit form submission
        function handleGuardEdit(e) {
            e.preventDefault();
            
            const guardId = parseInt(e.target.dataset.guardId);
            const guard = guards.find(g => g.id === guardId);
            
            if (guard) {
                // Update guard data
                guard.name = document.getElementById('editGuardName').value;
                guard.status = document.getElementById('editGuardStatus').value;
                guard.location = document.getElementById('editGuardLocation').value;
                guard.shift = document.getElementById('editGuardShift').value;
                
                // Update avatar initials if name changed
                const nameParts = guard.name.split(' ');
                guard.avatar = nameParts.map(part => part.charAt(0)).join('').toUpperCase();
                
                // Simulate form submission delay
                setTimeout(() => {
                    closeModal('editGuardModal');
                    showNotification(`${guard.name}'s information updated successfully!`, 'success');
                    
                    // Re-render guards table if visible
                    const guardsPage = document.getElementById('guardsPage');
                    if (guardsPage && !guardsPage.classList.contains('hidden')) {
                        renderGuards();
                    }
                    
                    // Update dashboard stats
                    updateDashboardStats();
                }, 500);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const activeGuards = guards.filter(g => g.status === 'on_duty').length;
            const onBreakGuards = guards.filter(g => g.status === 'on_break').length;
            const offDutyGuards = guards.filter(g => g.status === 'off_duty').length;
            
            // Update dashboard cards if visible
            const dashboardPage = document.getElementById('dashboardPage');
            if (dashboardPage && !dashboardPage.classList.contains('hidden')) {
                const activeGuardElements = document.querySelectorAll('.text-2xl.font-bold.text-gray-900');
                if (activeGuardElements[0]) {
                    activeGuardElements[0].textContent = activeGuards;
                }
            }
            
            // Update guards page stats
            const guardsPage = document.getElementById('guardsPage');
            if (guardsPage && !guardsPage.classList.contains('hidden')) {
                const statElements = guardsPage.querySelectorAll('.text-2xl.font-bold.text-gray-900');
                if (statElements[0]) statElements[0].textContent = activeGuards;
                if (statElements[1]) statElements[1].textContent = onBreakGuards;
                if (statElements[2]) statElements[2].textContent = offDutyGuards;
            }
        }

        // Emergency function
        function triggerEmergency() {
            closeModal('emergencyModal');
            showNotification('Emergency alert sent to all personnel!', 'error');
            
            // Simulate emergency response
            setTimeout(() => {
                showNotification('Emergency response team notified', 'info');
            }, 2000);
        }

        // Delete guard function
        function deleteGuard(guardId) {
            const guard = guards.find(g => g.id === guardId);
            if (guard) {
                // Populate the delete confirmation modal
                document.getElementById('deleteGuardName').textContent = guard.name;
                
                // Store the guard ID for deletion
                document.getElementById('confirmDeleteGuard').onclick = function() {
                    confirmDeleteGuard(guardId);
                };
                
                // Open the confirmation modal
                openModal('deleteGuardModal');
            }
        }

        function confirmDeleteGuard(guardId) {
            const guardIndex = guards.findIndex(g => g.id === guardId);
            const guard = guards[guardIndex];
            
            if (guardIndex !== -1) {
                // Remove guard from array
                guards.splice(guardIndex, 1);
                
                // Close modal and show success message
                closeModal('deleteGuardModal');
                showNotification(`${guard.name} has been removed from the system`, 'success');
                
                // Re-render guards table if visible
                const guardsPage = document.getElementById('guardsPage');
                if (guardsPage && !guardsPage.classList.contains('hidden')) {
                    renderGuards();
                }
                
                // Update dashboard stats
                updateDashboardStats();
            }
        }

        // Guard action functions
        function viewGuard(guardId) {
            const guard = guards.find(g => g.id === guardId);
            if (guard) {
                // Populate the view modal with guard data
                document.getElementById('viewGuardName').textContent = guard.name;
                document.getElementById('viewGuardAvatar').textContent = guard.avatar;
                document.getElementById('viewGuardId').textContent = `ID: ${guard.id.toString().padStart(3, '0')}`;
                document.getElementById('viewGuardLocation').textContent = guard.location;
                document.getElementById('viewGuardCheckin').textContent = guard.lastCheckin;
                document.getElementById('viewGuardShift').textContent = guard.shift;
                
                // Set status with appropriate styling
                const statusElement = document.getElementById('viewGuardStatus');
                const workStatusElement = document.getElementById('viewGuardWorkStatus');
                const statusText = guard.status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                const statusClass = guard.status === 'on_duty' ? 'bg-green-100 text-green-800' : 
                                  guard.status === 'on_break' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                
                statusElement.textContent = statusText;
                statusElement.className = `px-3 py-1 rounded-full text-sm ${statusClass}`;
                workStatusElement.textContent = statusText;
                workStatusElement.className = `px-2 py-1 text-sm rounded-full ${statusClass}`;
                
                // Populate additional information
                document.getElementById('viewGuardFullName').textContent = guard.name;
                document.getElementById('viewGuardEmployeeId').textContent = `SEC-${guard.id.toString().padStart(3, '0')}`;
                document.getElementById('viewGuardZone').textContent = guard.location;
                document.getElementById('viewGuardSchedule').textContent = guard.shift + ' (6 AM - 6 PM)';
                
                // Generate sample data for additional fields
                const phoneNumber = `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
                const emergencyNumber = `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
                const email = `${guard.name.toLowerCase().replace(' ', '.')}@securewatch.com`;
                
                document.getElementById('viewGuardPhone').textContent = phoneNumber;
                document.getElementById('viewGuardEmail').textContent = email;
                document.getElementById('viewGuardEmergency').textContent = emergencyNumber;
                document.getElementById('viewGuardHireDate').textContent = 'Jan 15, 2023';
                document.getElementById('viewGuardSupervisor').textContent = 'Sarah Johnson';
                document.getElementById('viewGuardHours').textContent = `${Math.floor(Math.random() * 40) + 160} hrs`;
                
                // Store the guard ID for actions
                document.getElementById('viewGuardModal').dataset.guardId = guardId;
                
                // Open the modal
                openModal('viewGuardModal');
            }
        }

        function contactGuard(guardId) {
            const guard = guards.find(g => g.id === guardId);
            if (guard) {
                // Populate the contact form with guard data
                document.getElementById('contactGuardName').textContent = guard.name;
                document.getElementById('contactGuardAvatar').textContent = guard.avatar;
                document.getElementById('contactGuardLocation').textContent = `${guard.location} • ${guard.shift}`;
                document.getElementById('contactGuardPhone').textContent = `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
                
                // Store the guard ID for contact actions
                document.getElementById('contactGuardModal').dataset.guardId = guardId;
                
                // Open the contact modal
                openModal('contactGuardModal');
            }
        }

        // Contact action functions
        function initiateCall() {
            const guardId = document.getElementById('contactGuardModal').dataset.guardId;
            const guard = guards.find(g => g.id === parseInt(guardId));
            if (guard) {
                closeModal('contactGuardModal');
                showNotification(`Calling ${guard.name}...`, 'info');
                // Simulate call connection
                setTimeout(() => {
                    showNotification('Call connected', 'success');
                }, 2000);
            }
        }

        function sendQuickMessage() {
            const guardId = document.getElementById('contactGuardModal').dataset.guardId;
            const guard = guards.find(g => g.id === parseInt(guardId));
            if (guard) {
                closeModal('contactGuardModal');
                showNotification(`Quick message sent to ${guard.name}`, 'success');
            }
        }

        function requestCheckIn() {
            const guardId = document.getElementById('contactGuardModal').dataset.guardId;
            const guard = guards.find(g => g.id === parseInt(guardId));
            if (guard) {
                closeModal('contactGuardModal');
                showNotification(`Check-in request sent to ${guard.name}`, 'info');
                // Simulate check-in response
                setTimeout(() => {
                    showNotification(`${guard.name} has checked in`, 'success');
                    guard.lastCheckin = 'Just now';
                    // Re-render guards table if visible
                    const guardsPage = document.getElementById('guardsPage');
                    if (guardsPage && !guardsPage.classList.contains('hidden')) {
                        renderGuards();
                    }
                }, 3000);
            }
        }

        function sendCustomMessage() {
            const guardId = document.getElementById('contactGuardModal').dataset.guardId;
            const guard = guards.find(g => g.id === parseInt(guardId));
            const message = document.getElementById('customMessage').value.trim();
            
            if (guard && message) {
                closeModal('contactGuardModal');
                showNotification(`Custom message sent to ${guard.name}`, 'success');
                document.getElementById('customMessage').value = '';
            } else if (!message) {
                showNotification('Please enter a message', 'warning');
            }
        }

        function editGuard(guardId) {
            const guard = guards.find(g => g.id === guardId);
            if (guard) {
                // Populate the edit form with guard data
                document.getElementById('editGuardName').value = guard.name;
                document.getElementById('editGuardId').value = guard.id.toString().padStart(3, '0');
                document.getElementById('editGuardStatus').value = guard.status;
                document.getElementById('editGuardLocation').value = guard.location;
                document.getElementById('editGuardShift').value = guard.shift;
                
                // Set some sample data for additional fields
                document.getElementById('editGuardPhone').value = `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
                document.getElementById('editGuardEmail').value = `${guard.name.toLowerCase().replace(' ', '.')}@securewatch.com`;
                document.getElementById('editGuardEmergency').value = `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
                
                // Set random certifications
                document.getElementById('certSecurity').checked = Math.random() > 0.2;
                document.getElementById('certFirstAid').checked = Math.random() > 0.4;
                document.getElementById('certFireSafety').checked = Math.random() > 0.6;
                document.getElementById('certDefensive').checked = Math.random() > 0.7;
                
                document.getElementById('editGuardNotes').value = `Experienced security guard assigned to ${guard.location}. Reliable and professional.`;
                
                // Store the guard ID for form submission
                document.getElementById('editGuardForm').dataset.guardId = guardId;
                
                // Open the modal
                openModal('editGuardModal');
            }
        }

        function editGuardFromView() {
            const guardId = document.getElementById('viewGuardModal').dataset.guardId;
            if (guardId) {
                // Close the view modal first
                closeModal('viewGuardModal');
                
                // Small delay to ensure smooth transition
                setTimeout(() => {
                    editGuard(parseInt(guardId));
                }, 200);
            }
        }

        // Notification dropdown functions
        function toggleNotificationDropdown() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.classList.toggle('hidden');
        }

        function markAllNotificationsRead() {
            // Mark all notifications as read (visual feedback)
            const unreadDots = document.querySelectorAll('#notificationDropdown .w-2.h-2.rounded-full');
            unreadDots.forEach(dot => {
                dot.style.display = 'none';
            });
            
            // Update notification badge
            const badge = document.querySelector('#notificationBtn .bg-red-500');
            if (badge) {
                badge.textContent = '0';
                badge.classList.add('hidden');
            }
            
            // Make read notifications more transparent
            const notificationItems = document.querySelectorAll('.notification-item');
            notificationItems.forEach(item => {
                if (!item.classList.contains('opacity-60')) {
                    item.classList.add('opacity-60');
                }
            });
            
            showNotification('All notifications marked as read', 'success');
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-triangle' : 
                        type === 'warning' ? 'fa-exclamation-circle' : 'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Incident management functions
        function viewIncidentDetails(incidentId) {
            const incident = incidents.find(i => i.id === incidentId);
            if (incident) {
                // Populate the incident details modal
                document.getElementById('incidentDetailType').textContent = incident.type;
                document.getElementById('incidentDetailLocation').textContent = incident.location;
                document.getElementById('incidentDetailTime').textContent = incident.time;
                document.getElementById('incidentDetailReporter').textContent = incident.reporter;
                document.getElementById('incidentDetailId').textContent = `#INC-${incident.id.toString().padStart(3, '0')}`;
                document.getElementById('incidentDetailDescription').textContent = incident.description;
                
                // Set priority with appropriate styling
                const priorityElement = document.getElementById('incidentDetailPriority');
                priorityElement.textContent = incident.priority.toUpperCase();
                const priorityClass = incident.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                   incident.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                priorityElement.className = `px-3 py-1 text-sm font-medium rounded-full ${priorityClass}`;
                
                // Set status with appropriate styling
                const statusElement = document.getElementById('incidentDetailStatus');
                statusElement.textContent = incident.status.toUpperCase().replace('_', ' ');
                const statusClass = incident.status === 'open' ? 'bg-red-100 text-red-800' : 
                                  incident.status === 'investigating' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';
                statusElement.className = `px-3 py-1 text-sm font-medium rounded-full ml-2 ${statusClass}`;
                
                // Set additional details
                document.getElementById('incidentDetailActions').textContent = 'Security team dispatched immediately. Area secured and individual escorted off premises. Reviewing security footage for identification.';
                document.getElementById('incidentDetailSeverity').textContent = incident.priority === 'high' ? 'Critical' : incident.priority === 'medium' ? 'Moderate' : 'Low';
                document.getElementById('incidentDetailResponseTime').textContent = '3 minutes';
                
                // Store incident ID for actions
                document.getElementById('viewIncidentModal').dataset.incidentId = incidentId;
                
                // Open the modal
                openModal('viewIncidentModal');
            }
        }

        function updateIncidentStatus(incidentId) {
            const incident = incidents.find(i => i.id === incidentId);
            if (incident) {
                // Show loading state on button
                const updateBtn = event.target;
                const originalText = updateBtn.innerHTML;
                updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
                updateBtn.disabled = true;
                
                // Simulate loading delay
                setTimeout(() => {
                    // Reset button
                    updateBtn.innerHTML = originalText;
                    updateBtn.disabled = false;
                    
                    // Populate the update form with current incident data
                    document.getElementById('currentIncidentStatus').textContent = incident.status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    document.getElementById('newIncidentPriority').value = incident.priority;
                    
                    // Pre-populate the new status dropdown with logical next steps
                    const newStatusSelect = document.getElementById('newIncidentStatus');
                    newStatusSelect.innerHTML = '';
                    
                    // Add status options based on current status
                    const statusOptions = getNextStatusOptions(incident.status);
                    statusOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        newStatusSelect.appendChild(optionElement);
                    });
                    
                    // Store incident ID for form submission
                    document.getElementById('updateIncidentForm').dataset.incidentId = incidentId;
                    
                    // Close view modal if open
                    closeModal('viewIncidentModal');
                    
                    // Open update modal with enhanced functionality
                    openModal('updateIncidentModal');
                    
                    // Focus on the status dropdown
                    setTimeout(() => {
                        newStatusSelect.focus();
                    }, 300);
                }, 800);
            }
        }
        
        function getNextStatusOptions(currentStatus) {
            const statusWorkflow = {
                'open': [
                    { value: 'investigating', text: 'Investigating' },
                    { value: 'in_progress', text: 'In Progress' },
                    { value: 'resolved', text: 'Resolved' },
                    { value: 'closed', text: 'Closed' }
                ],
                'investigating': [
                    { value: 'in_progress', text: 'In Progress' },
                    { value: 'resolved', text: 'Resolved' },
                    { value: 'closed', text: 'Closed' },
                    { value: 'open', text: 'Reopen' }
                ],
                'in_progress': [
                    { value: 'resolved', text: 'Resolved' },
                    { value: 'investigating', text: 'Back to Investigation' },
                    { value: 'closed', text: 'Closed' }
                ],
                'resolved': [
                    { value: 'closed', text: 'Closed' },
                    { value: 'open', text: 'Reopen' }
                ],
                'closed': [
                    { value: 'open', text: 'Reopen' }
                ]
            };
            
            return statusWorkflow[currentStatus] || [
                { value: 'investigating', text: 'Investigating' },
                { value: 'in_progress', text: 'In Progress' },
                { value: 'resolved', text: 'Resolved' },
                { value: 'closed', text: 'Closed' }
            ];
        }

        function handleIncidentStatusUpdate(e) {
            e.preventDefault();
            
            const incidentId = parseInt(e.target.dataset.incidentId);
            const incident = incidents.find(i => i.id === incidentId);
            
            if (incident) {
                const newStatus = document.getElementById('newIncidentStatus').value;
                const newPriority = document.getElementById('newIncidentPriority').value;
                const notes = document.getElementById('incidentUpdateNotes').value.trim();
                
                // Validation
                if (!newStatus) {
                    showNotification('Please select a new status', 'warning');
                    return;
                }
                
                if (!notes) {
                    showNotification('Please provide update notes', 'warning');
                    document.getElementById('incidentUpdateNotes').focus();
                    return;
                }
                
                // Show loading state on submit button
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
                submitBtn.disabled = true;
                
                // Store previous values for rollback if needed
                const previousStatus = incident.status;
                const previousPriority = incident.priority;
                
                // Update incident data
                incident.status = newStatus;
                incident.priority = newPriority;
                incident.lastUpdated = new Date().toLocaleString();
                incident.updateNotes = notes;
                incident.updatedBy = currentUser ? currentUser.fullName : 'System Administrator';
                
                // Add to incident history
                if (!incident.history) {
                    incident.history = [];
                }
                incident.history.push({
                    timestamp: new Date().toLocaleString(),
                    action: 'Status Updated',
                    previousStatus: previousStatus,
                    newStatus: newStatus,
                    previousPriority: previousPriority,
                    newPriority: newPriority,
                    notes: notes,
                    updatedBy: currentUser ? currentUser.fullName : 'System Administrator'
                });
                
                // Simulate form submission delay with enhanced processing
                setTimeout(() => {
                    // Reset button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    
                    closeModal('updateIncidentModal');
                    
                    // Show detailed success message
                    const statusText = newStatus.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    showNotification(`Incident #INC-${incident.id.toString().padStart(3, '0')} status updated to "${statusText}"`, 'success');
                    
                    // Show additional notifications based on status
                    setTimeout(() => {
                        if (newStatus === 'resolved') {
                            showNotification('Incident marked as resolved. Supervisor has been notified.', 'info');
                        } else if (newStatus === 'closed') {
                            showNotification('Incident closed. Final report will be generated automatically.', 'info');
                        } else if (newStatus === 'investigating') {
                            showNotification('Investigation team has been notified of status change.', 'info');
                        } else if (newStatus === 'in_progress') {
                            showNotification('Response team alerted. Incident is now in active resolution.', 'info');
                        }
                    }, 1500);
                    
                    // Re-render incidents list if visible
                    const incidentsPage = document.getElementById('incidentsPage');
                    if (incidentsPage && !incidentsPage.classList.contains('hidden')) {
                        renderIncidents();
                    }
                    
                    // Update dashboard stats if visible
                    updateIncidentStats();
                    
                    // Clear form
                    document.getElementById('updateIncidentForm').reset();
                    
                    // Auto-reopen incident details modal with updated information
                    setTimeout(() => {
                        viewIncidentDetails(incidentId);
                    }, 2000);
                    
                }, 1200);
            }
        }
        
        function updateIncidentStats() {
            // Update incident statistics on dashboard
            const openIncidents = incidents.filter(i => i.status === 'open').length;
            const resolvedToday = incidents.filter(i => i.status === 'resolved' || i.status === 'closed').length;
            const highPriority = incidents.filter(i => i.priority === 'high' && i.status !== 'closed').length;
            const mediumPriority = incidents.filter(i => i.priority === 'medium' && i.status !== 'closed').length;
            const lowPriority = incidents.filter(i => i.priority === 'low' && i.status !== 'closed').length;
            
            // Update dashboard cards if visible
            const dashboardPage = document.getElementById('dashboardPage');
            if (dashboardPage && !dashboardPage.classList.contains('hidden')) {
                const incidentStatElements = dashboardPage.querySelectorAll('.text-2xl.font-bold.text-gray-900');
                if (incidentStatElements[1]) {
                    incidentStatElements[1].textContent = openIncidents;
                }
            }
            
            // Update incidents page stats if visible
            const incidentsPage = document.getElementById('incidentsPage');
            if (incidentsPage && !incidentsPage.classList.contains('hidden')) {
                const statElements = incidentsPage.querySelectorAll('.text-2xl.font-bold.text-gray-900');
                if (statElements[0]) statElements[0].textContent = highPriority;
                if (statElements[1]) statElements[1].textContent = mediumPriority;
                if (statElements[2]) statElements[2].textContent = lowPriority;
                if (statElements[3]) statElements[3].textContent = resolvedToday;
            }
        }

        function assignIncident() {
            const incidentId = document.getElementById('viewIncidentModal').dataset.incidentId;
            const incident = incidents.find(i => i.id === parseInt(incidentId));
            
            if (incident) {
                // Show loading state on button
                const assignBtn = event.target;
                const originalText = assignBtn.innerHTML;
                assignBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
                assignBtn.disabled = true;
                
                // Simulate assignment processing
                setTimeout(() => {
                    // Reset button
                    assignBtn.innerHTML = originalText;
                    assignBtn.disabled = false;
                    
                    // Get available personnel for assignment
                    const availablePersonnel = getAvailablePersonnel();
                    
                    // Auto-assign based on incident priority and type
                    const assignment = autoAssignPersonnel(incident, availablePersonnel);
                    
                    // Update incident with assignment
                    if (!incident.assignedPersonnel) {
                        incident.assignedPersonnel = [];
                    }
                    
                    // Add new assignments
                    assignment.forEach(person => {
                        if (!incident.assignedPersonnel.find(p => p.id === person.id)) {
                            incident.assignedPersonnel.push({
                                ...person,
                                assignedAt: new Date().toLocaleString(),
                                assignedBy: currentUser ? currentUser.fullName : 'System Administrator'
                            });
                        }
                    });
                    
                    // Add to incident history
                    if (!incident.history) {
                        incident.history = [];
                    }
                    incident.history.push({
                        timestamp: new Date().toLocaleString(),
                        action: 'Personnel Assigned',
                        details: `${assignment.length} personnel assigned to incident`,
                        assignedPersonnel: assignment.map(p => p.name).join(', '),
                        assignedBy: currentUser ? currentUser.fullName : 'System Administrator'
                    });
                    
                    // Show success notification with details
                    const assignedNames = assignment.map(p => p.name).join(', ');
                    showNotification(`Personnel assigned: ${assignedNames}`, 'success');
                    
                    // Show additional notifications
                    setTimeout(() => {
                        showNotification('Assignment notifications sent to personnel', 'info');
                    }, 1000);
                    
                    setTimeout(() => {
                        if (incident.priority === 'high') {
                            showNotification('Supervisor has been notified of high-priority assignment', 'info');
                        }
                    }, 2000);
                    
                    // Update the personnel section in the modal
                    updateIncidentPersonnelDisplay(incident);
                    
                    // Re-render incidents list if visible
                    const incidentsPage = document.getElementById('incidentsPage');
                    if (incidentsPage && !incidentsPage.classList.contains('hidden')) {
                        renderIncidents();
                    }
                    
                }, 1200);
            }
        }

        function escalateIncident() {
            const incidentId = document.getElementById('viewIncidentModal').dataset.incidentId;
            const incident = incidents.find(i => i.id === parseInt(incidentId));
            
            if (incident) {
                // Show loading state on button
                const escalateBtn = event.target;
                const originalText = escalateBtn.innerHTML;
                escalateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Escalating...';
                escalateBtn.disabled = true;
                
                // Store previous priority for history
                const previousPriority = incident.priority;
                
                // Simulate escalation processing
                setTimeout(() => {
                    // Reset button
                    escalateBtn.innerHTML = originalText;
                    escalateBtn.disabled = false;
                    
                    // Escalate priority with comprehensive logic
                    let escalationLevel = '';
                    let escalationActions = [];
                    
                    if (incident.priority === 'low') {
                        incident.priority = 'medium';
                        escalationLevel = 'Medium Priority';
                        escalationActions = [
                            'Incident moved to medium priority queue',
                            'Response team leader notified',
                            'Enhanced monitoring activated'
                        ];
                    } else if (incident.priority === 'medium') {
                        incident.priority = 'high';
                        escalationLevel = 'High Priority';
                        escalationActions = [
                            'Incident escalated to high priority',
                            'Senior management notified',
                            'Emergency response protocols activated',
                            'Additional resources allocated'
                        ];
                    } else {
                        // Already high priority - escalate to critical
                        escalationLevel = 'Critical Priority';
                        escalationActions = [
                            'Incident marked as CRITICAL',
                            'Executive team notified immediately',
                            'All available resources mobilized',
                            'External authorities may be contacted'
                        ];
                    }
                    
                    // Add to incident history
                    if (!incident.history) {
                        incident.history = [];
                    }
                    incident.history.push({
                        timestamp: new Date().toLocaleString(),
                        action: 'Incident Escalated',
                        previousPriority: previousPriority,
                        newPriority: incident.priority,
                        escalationLevel: escalationLevel,
                        escalatedBy: currentUser ? currentUser.fullName : 'System Administrator',
                        actions: escalationActions
                    });
                    
                    // Update incident status if still open
                    if (incident.status === 'open') {
                        incident.status = 'investigating';
                    }
                    
                    // Auto-assign additional personnel for high priority
                    if (incident.priority === 'high') {
                        const additionalPersonnel = getEmergencyPersonnel();
                        if (!incident.assignedPersonnel) {
                            incident.assignedPersonnel = [];
                        }
                        
                        additionalPersonnel.forEach(person => {
                            if (!incident.assignedPersonnel.find(p => p.id === person.id)) {
                                incident.assignedPersonnel.push({
                                    ...person,
                                    assignedAt: new Date().toLocaleString(),
                                    assignedBy: 'Auto-assigned (Escalation)',
                                    role: 'Emergency Response'
                                });
                            }
                        });
                    }
                    
                    // Show escalation notification
                    showNotification(`Incident #INC-${incident.id.toString().padStart(3, '0')} escalated to ${escalationLevel}`, 'warning');
                    
                    // Show progressive notifications for escalation actions
                    escalationActions.forEach((action, index) => {
                        setTimeout(() => {
                            showNotification(action, 'info');
                        }, (index + 1) * 1000);
                    });
                    
                    // Update the incident details display
                    updateIncidentDetailsDisplay(incident);
                    
                    // Re-render incidents list if visible
                    const incidentsPage = document.getElementById('incidentsPage');
                    if (incidentsPage && !incidentsPage.classList.contains('hidden')) {
                        renderIncidents();
                    }
                    
                    // Update dashboard stats
                    updateIncidentStats();
                    
                }, 1000);
            }
        }

        // Authentication Functions
        function checkAuthenticationStatus() {
            // Check if user is logged in (from localStorage)
            const savedUser = localStorage.getItem('securewatch_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isAuthenticated = true;
                updateUIForAuthenticatedUser();
            } else {
                // Show login modal on first visit
                setTimeout(() => {
                    openModal('loginModal');
                }, 1000);
                updateUIForUnauthenticatedUser();
            }
        }

        function updateUIForAuthenticatedUser() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.fullName;
                document.getElementById('userRole').textContent = currentUser.role;
                document.getElementById('userAvatar').textContent = currentUser.avatar;
                document.getElementById('userProfile').classList.remove('hidden');
                document.getElementById('authButtons').classList.add('hidden');
            }
        }

        function updateUIForUnauthenticatedUser() {
            document.getElementById('userProfile').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Find user by username or email
            const user = adminUsers.find(u => 
                u.username === username || u.email === username
            );
            
            if (user && user.password === password) {
                // Successful login
                currentUser = { ...user };
                delete currentUser.password; // Don't store password
                isAuthenticated = true;
                
                // Save to localStorage if remember me is checked
                if (rememberMe) {
                    localStorage.setItem('securewatch_user', JSON.stringify(currentUser));
                } else {
                    sessionStorage.setItem('securewatch_user', JSON.stringify(currentUser));
                }
                
                closeModal('loginModal');
                updateUIForAuthenticatedUser();
                showNotification(`Welcome back, ${currentUser.fullName}!`, 'success');
                
                // Clear form
                document.getElementById('loginForm').reset();
            } else {
                // Failed login
                showNotification('Invalid username/email or password', 'error');
                
                // Add shake animation to form
                const form = document.getElementById('loginForm');
                form.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    form.style.animation = '';
                }, 500);
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('signupFullName').value.trim();
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const role = document.getElementById('signupRole').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            // Check if username or email already exists
            const existingUser = adminUsers.find(u => 
                u.username === username || u.email === email
            );
            
            if (existingUser) {
                showNotification('Username or email already exists', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: adminUsers.length + 1,
                username: username,
                email: email,
                password: password, // In real app, this would be hashed
                fullName: fullName,
                role: role,
                avatar: fullName.split(' ').map(n => n[0]).join('').toUpperCase(),
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            // Add to users array
            adminUsers.push(newUser);
            
            // Auto-login the new user
            currentUser = { ...newUser };
            delete currentUser.password;
            isAuthenticated = true;
            
            // Save to localStorage
            localStorage.setItem('securewatch_user', JSON.stringify(currentUser));
            
            closeModal('signupModal');
            updateUIForAuthenticatedUser();
            showNotification(`Account created successfully! Welcome, ${currentUser.fullName}!`, 'success');
            
            // Clear form
            document.getElementById('signupForm').reset();
            resetPasswordStrength();
        }

        function logout() {
            // Clear user data
            currentUser = null;
            isAuthenticated = false;
            
            // Clear storage
            localStorage.removeItem('securewatch_user');
            sessionStorage.removeItem('securewatch_user');
            
            // Update UI
            updateUIForUnauthenticatedUser();
            
            // Show login modal
            setTimeout(() => {
                openModal('loginModal');
            }, 500);
            
            showNotification('You have been logged out successfully', 'info');
        }

        function switchToSignup() {
            closeModal('loginModal');
            setTimeout(() => {
                openModal('signupModal');
            }, 200);
        }

        function switchToLogin() {
            closeModal('signupModal');
            setTimeout(() => {
                openModal('loginModal');
            }, 200);
        }

        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function checkPasswordStrength() {
            const password = document.getElementById('signupPassword').value;
            const strengthText = document.getElementById('passwordStrength');
            const strengthBar = document.getElementById('passwordStrengthBar');
            
            let strength = 0;
            let strengthLabel = 'Weak';
            let color = '#ef4444';
            
            // Length check
            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 10;
            
            // Character variety checks
            if (/[a-z]/.test(password)) strength += 15;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^A-Za-z0-9]/.test(password)) strength += 20;
            
            // Determine strength label and color
            if (strength >= 80) {
                strengthLabel = 'Very Strong';
                color = '#10b981';
            } else if (strength >= 60) {
                strengthLabel = 'Strong';
                color = '#059669';
            } else if (strength >= 40) {
                strengthLabel = 'Medium';
                color = '#f59e0b';
            } else if (strength >= 20) {
                strengthLabel = 'Fair';
                color = '#f97316';
            }
            
            strengthText.textContent = strengthLabel;
            strengthBar.style.width = strength + '%';
            strengthBar.style.backgroundColor = color;
        }

        function resetPasswordStrength() {
            document.getElementById('passwordStrength').textContent = 'Weak';
            document.getElementById('passwordStrengthBar').style.width = '0%';
            document.getElementById('passwordStrengthBar').style.backgroundColor = '#ef4444';
        }

        // Add shake animation CSS
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(shakeStyle);

        // User Management Functions
        function renderUsers() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;

            const filteredUsers = getFilteredUsers();

            tbody.innerHTML = filteredUsers.map(user => {
                const statusClass = user.status === 'active' ? 'bg-green-100 text-green-800' : 
                                  user.status === 'inactive' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800';
                const statusText = user.status.charAt(0).toUpperCase() + user.status.slice(1);

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-sm font-medium text-blue-600">${user.avatar}</span>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${user.fullName}</div>
                                    <div class="text-sm text-gray-500">${user.username} • ${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${user.role}</div>
                            <div class="text-sm text-gray-500">${user.department || 'Not assigned'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${user.lastLogin || 'Never'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${formatDate(user.createdAt)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                            <button onclick="resetUserPassword(${user.id})" class="text-yellow-600 hover:text-yellow-900 mr-3">Reset Password</button>
                            ${user.id !== currentUser?.id ? `<button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-900">Delete</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getFilteredUsers() {
            const searchTerm = document.getElementById('userSearch')?.value.toLowerCase() || '';
            const roleFilter = document.getElementById('roleFilter')?.value || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';

            return adminUsers.filter(user => {
                const matchesSearch = user.fullName.toLowerCase().includes(searchTerm) ||
                                    user.username.toLowerCase().includes(searchTerm) ||
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || user.role === roleFilter;
                const matchesStatus = !statusFilter || user.status === statusFilter;

                return matchesSearch && matchesRole && matchesStatus;
            });
        }

        function filterUsers() {
            renderUsers();
        }

        function updateUserStats() {
            const totalUsers = adminUsers.length;
            const activeUsers = adminUsers.filter(u => u.status === 'active').length;
            const adminCount = adminUsers.filter(u => u.role === 'Super Admin').length;
            const pendingUsers = adminUsers.filter(u => u.status === 'pending').length;

            // Update stats in user management page
            const totalElement = document.getElementById('totalUsersCount');
            const activeElement = document.getElementById('activeUsersCount');
            const adminElement = document.getElementById('adminUsersCount');
            const pendingElement = document.getElementById('pendingUsersCount');
            const userCountBadge = document.getElementById('userCount');

            if (totalElement) totalElement.textContent = totalUsers;
            if (activeElement) activeElement.textContent = activeUsers;
            if (adminElement) adminElement.textContent = adminCount;
            if (pendingElement) pendingElement.textContent = pendingUsers;
            if (userCountBadge) userCountBadge.textContent = totalUsers;
        }

        function openCreateUserModal() {
            // Clear form
            document.getElementById('createUserForm').reset();
            
            // Reset password strength
            resetCreatePasswordStrength();
            
            // Set default permissions
            document.getElementById('permDashboard').checked = true;
            document.getElementById('requirePasswordChange').checked = true;
            document.getElementById('sendWelcomeEmail').checked = true;
            
            openModal('createUserModal');
        }

        function handleCreateUser(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('createUserFullName').value.trim();
            const username = document.getElementById('createUserUsername').value.trim();
            const email = document.getElementById('createUserEmail').value.trim();
            const role = document.getElementById('createUserRole').value;
            const department = document.getElementById('createUserDepartment').value;
            const password = document.getElementById('createUserPassword').value;
            const confirmPassword = document.getElementById('createUserConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            // Check if username or email already exists
            const existingUser = adminUsers.find(u => 
                u.username === username || u.email === email
            );
            
            if (existingUser) {
                showNotification('Username or email already exists', 'error');
                return;
            }
            
            // Collect permissions
            const permissions = [];
            if (document.getElementById('permDashboard').checked) permissions.push('dashboard');
            if (document.getElementById('permGuards').checked) permissions.push('guards');
            if (document.getElementById('permIncidents').checked) permissions.push('incidents');
            if (document.getElementById('permReports').checked) permissions.push('reports');
            if (document.getElementById('permZones').checked) permissions.push('zones');
            if (document.getElementById('permUsers').checked) permissions.push('users');
            
            // Create new user
            const newUser = {
                id: Math.max(...adminUsers.map(u => u.id)) + 1,
                username: username,
                email: email,
                password: password, // In real app, this would be hashed
                fullName: fullName,
                role: role,
                avatar: fullName.split(' ').map(n => n[0]).join('').toUpperCase(),
                status: 'active',
                department: department,
                lastLogin: null,
                createdAt: new Date().toISOString().split('T')[0],
                permissions: permissions
            };
            
            // Add to users array
            adminUsers.push(newUser);
            
            // Simulate form submission delay
            setTimeout(() => {
                closeModal('createUserModal');
                showNotification(`User ${fullName} created successfully!`, 'success');
                
                // Re-render users table if visible
                const usersPage = document.getElementById('usersPage');
                if (usersPage && !usersPage.classList.contains('hidden')) {
                    renderUsers();
                    updateUserStats();
                }
                
                // Send welcome email simulation
                if (document.getElementById('sendWelcomeEmail').checked) {
                    setTimeout(() => {
                        showNotification(`Welcome email sent to ${email}`, 'info');
                    }, 1000);
                }
            }, 500);
        }

        function editUser(userId) {
            const user = adminUsers.find(u => u.id === userId);
            if (user) {
                // Populate the edit form
                document.getElementById('editUserFullName').value = user.fullName;
                document.getElementById('editUserUsername').value = user.username;
                document.getElementById('editUserEmail').value = user.email;
                document.getElementById('editUserRole').value = user.role;
                document.getElementById('editUserStatus').value = user.status;
                document.getElementById('editUserDepartment').value = user.department || '';
                document.getElementById('editUserNotes').value = `User created on ${formatDate(user.createdAt)}. Last login: ${user.lastLogin || 'Never'}`;
                
                // Store user ID for form submission
                document.getElementById('editUserForm').dataset.userId = userId;
                
                openModal('editUserModal');
            }
        }

        function handleEditUser(e) {
            e.preventDefault();
            
            const userId = parseInt(e.target.dataset.userId);
            const user = adminUsers.find(u => u.id === userId);
            
            if (user) {
                // Update user data
                user.fullName = document.getElementById('editUserFullName').value.trim();
                user.username = document.getElementById('editUserUsername').value.trim();
                user.email = document.getElementById('editUserEmail').value.trim();
                user.role = document.getElementById('editUserRole').value;
                user.status = document.getElementById('editUserStatus').value;
                user.department = document.getElementById('editUserDepartment').value;
                
                // Update avatar
                user.avatar = user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                
                setTimeout(() => {
                    closeModal('editUserModal');
                    showNotification(`${user.fullName}'s information updated successfully!`, 'success');
                    
                    // Re-render users table if visible
                    const usersPage = document.getElementById('usersPage');
                    if (usersPage && !usersPage.classList.contains('hidden')) {
                        renderUsers();
                        updateUserStats();
                    }
                    
                    // Update current user info if editing self
                    if (currentUser && currentUser.id === userId) {
                        currentUser.fullName = user.fullName;
                        currentUser.role = user.role;
                        currentUser.avatar = user.avatar;
                        updateUIForAuthenticatedUser();
                    }
                }, 500);
            }
        }

        function deleteUser(userId) {
            const user = adminUsers.find(u => u.id === userId);
            if (user) {
                // Prevent deleting self
                if (currentUser && currentUser.id === userId) {
                    showNotification('You cannot delete your own account', 'error');
                    return;
                }
                
                // Populate the delete confirmation modal
                document.getElementById('deleteUserName').textContent = user.fullName;
                
                // Store the user ID for deletion
                document.getElementById('confirmDeleteUser').onclick = function() {
                    confirmDeleteUser(userId);
                };
                
                openModal('deleteUserModal');
            }
        }

        function confirmDeleteUser(userId) {
            const userIndex = adminUsers.findIndex(u => u.id === userId);
            const user = adminUsers[userIndex];
            
            if (userIndex !== -1) {
                // Remove user from array
                adminUsers.splice(userIndex, 1);
                
                closeModal('deleteUserModal');
                showNotification(`${user.fullName} has been removed from the system`, 'success');
                
                // Re-render users table if visible
                const usersPage = document.getElementById('usersPage');
                if (usersPage && !usersPage.classList.contains('hidden')) {
                    renderUsers();
                    updateUserStats();
                }
            }
        }

        function resetUserPassword(userId) {
            const user = adminUsers.find(u => u.id === userId);
            if (user) {
                // Generate random password
                const newPassword = generateRandomPassword();
                user.password = newPassword;
                
                showNotification(`Password reset for ${user.fullName}. New password: ${newPassword}`, 'info');
                
                // In real app, this would send an email instead of showing the password
                setTimeout(() => {
                    showNotification('Password reset email sent to user', 'success');
                }, 1000);
            }
        }

        function generateRandomPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        function checkCreatePasswordStrength() {
            const password = document.getElementById('createUserPassword').value;
            const strengthText = document.getElementById('createPasswordStrength');
            const strengthBar = document.getElementById('createPasswordStrengthBar');
            
            let strength = 0;
            let strengthLabel = 'Weak';
            let color = '#ef4444';
            
            // Length check
            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 10;
            
            // Character variety checks
            if (/[a-z]/.test(password)) strength += 15;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^A-Za-z0-9]/.test(password)) strength += 20;
            
            // Determine strength label and color
            if (strength >= 80) {
                strengthLabel = 'Very Strong';
                color = '#10b981';
            } else if (strength >= 60) {
                strengthLabel = 'Strong';
                color = '#059669';
            } else if (strength >= 40) {
                strengthLabel = 'Medium';
                color = '#f59e0b';
            } else if (strength >= 20) {
                strengthLabel = 'Fair';
                color = '#f97316';
            }
            
            strengthText.textContent = strengthLabel;
            strengthBar.style.width = strength + '%';
            strengthBar.style.backgroundColor = color;
        }

        function resetCreatePasswordStrength() {
            document.getElementById('createPasswordStrength').textContent = 'Weak';
            document.getElementById('createPasswordStrengthBar').style.width = '0%';
            document.getElementById('createPasswordStrengthBar').style.backgroundColor = '#ef4444';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Download Incident Report Function
        function downloadIncidentReport() {
            const incidentId = document.getElementById('viewIncidentModal').dataset.incidentId;
            const incident = incidents.find(i => i.id === parseInt(incidentId));
            
            if (incident) {
                // Show loading state
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Generating...';
                btn.disabled = true;
                
                // Simulate report generation
                setTimeout(() => {
                    // Generate comprehensive incident report data
                    const reportData = generateIncidentReportData(incident);
                    
                    // Create and download CSV file
                    downloadCSV(reportData, `Incident-Report-${incident.id.toString().padStart(3, '0')}-${new Date().toISOString().split('T')[0]}.csv`);
                    
                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    
                    showNotification(`Incident report #${incident.id} downloaded successfully!`, 'success');
                }, 1500);
            }
        }

        function generateIncidentReportData(incident) {
            const reportData = [];
            
            // Report Header
            reportData.push(['SECUREWATCH INCIDENT REPORT']);
            reportData.push(['Report Generated:', new Date().toLocaleString()]);
            reportData.push(['Generated By:', currentUser ? currentUser.fullName : 'System Administrator']);
            reportData.push([]);
            
            // Incident Overview
            reportData.push(['INCIDENT OVERVIEW']);
            reportData.push(['Incident ID:', `#INC-${incident.id.toString().padStart(3, '0')}`]);
            reportData.push(['Type:', incident.type]);
            reportData.push(['Priority Level:', incident.priority.toUpperCase()]);
            reportData.push(['Current Status:', incident.status.toUpperCase().replace('_', ' ')]);
            reportData.push(['Location:', incident.location]);
            reportData.push(['Reported By:', incident.reporter]);
            reportData.push(['Report Time:', incident.time]);
            reportData.push(['Response Time:', '3 minutes']);
            reportData.push([]);
            
            // Incident Details
            reportData.push(['INCIDENT DETAILS']);
            reportData.push(['Description:', incident.description]);
            reportData.push(['Actions Taken:', 'Security team dispatched immediately. Area secured and individual escorted off premises. Reviewing security footage for identification.']);
            reportData.push(['Severity Assessment:', incident.priority === 'high' ? 'Critical' : incident.priority === 'medium' ? 'Moderate' : 'Low']);
            reportData.push([]);
            
            // Personnel Involved
            reportData.push(['PERSONNEL INVOLVED']);
            reportData.push(['Role', 'Name', 'Department', 'Involvement']);
            reportData.push(['Reporting Officer', 'John Smith', 'Zone A Security', 'Primary responder and incident reporter']);
            reportData.push(['Response Team', 'Sarah Johnson', 'Zone B Security', 'Support response and area containment']);
            reportData.push(['Supervisor', 'Mike Davis', 'Security Office', 'Incident oversight and coordination']);
            reportData.push([]);
            
            // Timeline of Events
            reportData.push(['INCIDENT TIMELINE']);
            reportData.push(['Time', 'Event', 'Details']);
            reportData.push(['14:30', 'Incident Reported', 'Motion sensor triggered in restricted area']);
            reportData.push(['14:31', 'Security Dispatched', 'Response team notified and dispatched']);
            reportData.push(['14:33', 'On-Site Response', 'Security personnel arrived at incident location']);
            reportData.push(['14:35', 'Area Secured', 'Individual identified and escorted from premises']);
            reportData.push(['14:40', 'Investigation Started', 'Security footage review initiated']);
            reportData.push(['14:45', 'Initial Report Filed', 'Preliminary incident report documented']);
            reportData.push([]);
            
            // Evidence and Documentation
            reportData.push(['EVIDENCE & DOCUMENTATION']);
            reportData.push(['Evidence Type', 'Description', 'Location', 'Status']);
            reportData.push(['Security Footage', 'Camera 12 - East Wing recording', 'Digital Archive', 'Secured']);
            reportData.push(['Scene Photos', '3 photographs of incident area', 'Evidence Locker', 'Catalogued']);
            reportData.push(['Access Logs', 'Door entry/exit records', 'Security Database', 'Reviewed']);
            reportData.push(['Witness Statements', 'Staff member observations', 'Case File', 'Documented']);
            reportData.push([]);
            
            // Security Assessment
            reportData.push(['SECURITY ASSESSMENT']);
            reportData.push(['Vulnerability Identified:', incident.priority === 'high' ? 'Yes - Critical security gap' : 'Minor procedural issue']);
            reportData.push(['Risk Level:', incident.priority === 'high' ? 'High - Immediate action required' : 'Medium - Monitor and improve']);
            reportData.push(['Containment Status:', 'Fully contained - No ongoing threat']);
            reportData.push(['System Impact:', 'Minimal - All systems operational']);
            reportData.push([]);
            
            // Recommendations
            reportData.push(['RECOMMENDATIONS & FOLLOW-UP']);
            if (incident.priority === 'high') {
                reportData.push(['Immediate Actions:', 'Review and strengthen access control protocols']);
                reportData.push(['Security Enhancements:', 'Install additional motion sensors in vulnerable areas']);
                reportData.push(['Training Requirements:', 'Conduct security awareness training for all staff']);
                reportData.push(['Policy Updates:', 'Update visitor access procedures']);
            } else {
                reportData.push(['Immediate Actions:', 'Continue standard monitoring procedures']);
                reportData.push(['Security Enhancements:', 'No immediate changes required']);
                reportData.push(['Training Requirements:', 'Standard training schedule maintained']);
                reportData.push(['Policy Updates:', 'Current policies adequate']);
            }
            reportData.push(['Follow-up Required:', incident.status === 'open' ? 'Yes - Ongoing investigation' : 'No - Case closed']);
            reportData.push(['Next Review Date:', new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString()]);
            reportData.push([]);
            
            // Incident Classification
            reportData.push(['INCIDENT CLASSIFICATION']);
            reportData.push(['Category:', incident.type]);
            reportData.push(['Sub-category:', incident.type === 'Security Breach' ? 'Unauthorized Access' : 'General Security']);
            reportData.push(['Threat Level:', incident.priority === 'high' ? 'Level 3 - High' : incident.priority === 'medium' ? 'Level 2 - Medium' : 'Level 1 - Low']);
            reportData.push(['Business Impact:', incident.priority === 'high' ? 'Significant' : 'Minimal']);
            reportData.push(['Regulatory Reporting:', incident.priority === 'high' ? 'Required' : 'Not Required']);
            reportData.push([]);
            
            // Contact Information
            reportData.push(['CONTACT INFORMATION']);
            reportData.push(['Primary Contact:', incident.reporter]);
            reportData.push(['Supervisor:', 'Mike Davis - Security Supervisor']);
            reportData.push(['Emergency Contact:', '(555) 911-HELP']);
            reportData.push(['Report Questions:', 'security@securewatch.com']);
            reportData.push([]);
            
            // Report Footer
            reportData.push(['REPORT CERTIFICATION']);
            reportData.push(['This report contains accurate information to the best of our knowledge']);
            reportData.push(['Report Status:', 'Official']);
            reportData.push(['Confidentiality:', 'Internal Use Only']);
            reportData.push(['Retention Period:', '7 years as per company policy']);
            reportData.push(['Digital Signature:', currentUser ? currentUser.fullName : 'System Administrator']);
            reportData.push(['Report Version:', '1.0']);
            
            return reportData;
        }

        // Generate Report Function
        function generateReport() {
            // Get current filter values
            const dateRange = document.querySelector('#reportsPage select').value;
            const reportType = document.querySelectorAll('#reportsPage select')[1].value;
            const zone = document.querySelectorAll('#reportsPage select')[2].value;
            
            // Show loading state
            const generateBtn = event.target;
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            generateBtn.disabled = true;
            
            // Simulate report generation
            setTimeout(() => {
                // Generate and display report data
                displayGeneratedReport(dateRange, reportType, zone);
                
                // Reset button
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
                
                showNotification('Report generated successfully!', 'success');
            }, 1500);
        }

        function displayGeneratedReport(dateRange, reportType, zone) {
            // Update the report summary section with generated data
            const summarySection = document.querySelector('#reportsPage .grid.grid-cols-1.lg\\:grid-cols-2.gap-6');
            
            // Generate sample statistics based on filters
            const stats = generateReportStats(dateRange, reportType, zone);
            
            // Update Weekly Summary
            const weeklySummary = summarySection.querySelector('.bg-white.rounded-xl.shadow-sm.p-6');
            const summaryItems = weeklySummary.querySelectorAll('.flex.justify-between.items-center');
            
            summaryItems[0].querySelector('.font-semibold').textContent = stats.totalIncidents;
            summaryItems[1].querySelector('.font-semibold').textContent = stats.resolvedIncidents;
            summaryItems[1].querySelector('.font-semibold').className = stats.resolvedIncidents >= stats.totalIncidents * 0.8 ? 'font-semibold text-green-600' : 'font-semibold text-yellow-600';
            summaryItems[2].querySelector('.font-semibold').textContent = stats.avgResponseTime + ' minutes';
            summaryItems[3].querySelector('.font-semibold').textContent = stats.guardEfficiency + '%';
            summaryItems[3].querySelector('.font-semibold').className = stats.guardEfficiency >= 90 ? 'font-semibold text-green-600' : 'font-semibold text-yellow-600';
            
            // Update Zone Performance
            const zonePerformance = summarySection.querySelectorAll('.bg-white.rounded-xl.shadow-sm.p-6')[1];
            const zoneItems = zonePerformance.querySelectorAll('.flex.items-center.justify-between');
            
            stats.zonePerformance.forEach((performance, index) => {
                if (zoneItems[index]) {
                    const progressBar = zoneItems[index].querySelector('.bg-green-500, .bg-yellow-500, .bg-red-500');
                    const percentage = zoneItems[index].querySelector('.text-sm.font-medium');
                    
                    if (progressBar && percentage) {
                        progressBar.style.width = performance.score + '%';
                        progressBar.className = performance.score >= 90 ? 'bg-green-500 h-2 rounded-full' : 
                                              performance.score >= 70 ? 'bg-yellow-500 h-2 rounded-full' : 
                                              'bg-red-500 h-2 rounded-full';
                        percentage.textContent = performance.score + '%';
                    }
                }
            });
            
            // Show filter information
            showNotification(`Report generated for ${dateRange} - ${reportType} - ${zone}`, 'info');
        }

        function generateReportStats(dateRange, reportType, zone) {
            // Generate realistic statistics based on filters
            let baseIncidents = 15;
            let baseResolved = 12;
            let baseResponseTime = 8;
            let baseEfficiency = 94;
            
            // Adjust based on date range
            if (dateRange === 'Last 30 days') {
                baseIncidents = 45;
                baseResolved = 38;
            } else if (dateRange === 'Last 3 months') {
                baseIncidents = 120;
                baseResolved = 105;
            }
            
            // Adjust based on report type
            if (reportType === 'Incident Reports') {
                baseIncidents = Math.floor(baseIncidents * 0.7);
                baseResolved = Math.floor(baseResolved * 0.8);
                baseResponseTime = 6;
            } else if (reportType === 'Guard Performance') {
                baseEfficiency = 96;
                baseResponseTime = 5;
            }
            
            // Adjust based on zone
            if (zone !== 'All Zones') {
                baseIncidents = Math.floor(baseIncidents * 0.4);
                baseResolved = Math.floor(baseResolved * 0.4);
            }
            
            return {
                totalIncidents: baseIncidents,
                resolvedIncidents: baseResolved,
                avgResponseTime: baseResponseTime,
                guardEfficiency: baseEfficiency,
                zonePerformance: [
                    { zone: 'Zone A', score: 95 },
                    { zone: 'Zone B', score: zone === 'Zone B' ? 85 : 78 },
                    { zone: 'Zone C', score: 92 }
                ]
            };
        }

        // Export Report Function
        function exportReport() {
            // Get current filter values
            const dateRange = document.querySelector('#reportsPage select').value;
            const reportType = document.querySelectorAll('#reportsPage select')[1].value;
            const zone = document.querySelectorAll('#reportsPage select')[2].value;
            
            // Show loading state
            const exportBtn = event.target;
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            exportBtn.disabled = true;
            
            // Simulate report generation
            setTimeout(() => {
                // Generate report data based on filters
                const reportData = generateReportData(dateRange, reportType, zone);
                
                // Create and download CSV file
                downloadCSV(reportData, `SecureWatch-Report-${dateRange.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.csv`);
                
                // Reset button
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
                
                showNotification('Security report downloaded successfully!', 'success');
            }, 1500);
        }

        function generateReportData(dateRange, reportType, zone) {
            const headers = ['Date', 'Time', 'Type', 'Location', 'Priority', 'Status', 'Reporter', 'Response Time (min)', 'Description'];
            const rows = [headers];
            
            // Add report metadata
            rows.push(['SECUREWATCH SECURITY REPORT']);
            rows.push(['Generated:', new Date().toLocaleString()]);
            rows.push(['Date Range:', dateRange]);
            rows.push(['Report Type:', reportType]);
            rows.push(['Zone Filter:', zone]);
            rows.push(['Generated By:', currentUser ? currentUser.fullName : 'System Administrator']);
            rows.push([]);
            rows.push(['INCIDENT DATA']);
            rows.push(headers);
            
            // Generate comprehensive sample data based on filters
            const sampleData = [
                ['2024-03-15', '14:30', 'Security Breach', 'Zone A - Building 1', 'High', 'Resolved', 'John Smith', '3', 'Unauthorized access detected in restricted area'],
                ['2024-03-15', '12:15', 'Suspicious Activity', 'Parking Lot B', 'Medium', 'Investigating', 'Sarah Johnson', '5', 'Individual loitering near vehicles'],
                ['2024-03-15', '09:45', 'Patrol Completed', 'Zone A - Perimeter', 'Low', 'Completed', 'Mike Davis', '0', 'Morning patrol round completed successfully'],
                ['2024-03-14', '16:45', 'Equipment Malfunction', 'Zone C - Camera 12', 'Medium', 'Open', 'System Alert', '8', 'Security camera offline - maintenance required'],
                ['2024-03-14', '14:20', 'Guard Check-in', 'Zone B - Checkpoint 3', 'Low', 'Completed', 'Lisa Wilson', '0', 'Scheduled check-in completed'],
                ['2024-03-14', '09:20', 'Patrol Completed', 'Zone A - Building 2', 'Low', 'Completed', 'Mike Davis', '0', 'Routine patrol round completed successfully'],
                ['2024-03-13', '22:30', 'Alarm Triggered', 'Main Entrance', 'High', 'Resolved', 'Lisa Wilson', '2', 'Motion sensor activated after hours - false alarm'],
                ['2024-03-13', '18:15', 'Visitor Issue', 'Reception', 'Low', 'Resolved', 'David Brown', '4', 'Visitor without proper identification - escorted out'],
                ['2024-03-13', '15:30', 'Guard Check-in', 'Zone C - East Wing', 'Low', 'Completed', 'Emma Taylor', '0', 'Afternoon check-in completed'],
                ['2024-03-12', '11:00', 'Maintenance Alert', 'Zone B - Door 7', 'Medium', 'In Progress', 'System Alert', '12', 'Door lock malfunction reported - technician dispatched'],
                ['2024-03-12', '08:45', 'Guard Check-in', 'Zone C - Security Office', 'Low', 'Completed', 'Emma Taylor', '0', 'Shift change completed successfully'],
                ['2024-03-12', '06:15', 'Patrol Completed', 'Zone A - Parking Area', 'Low', 'Completed', 'James Wilson', '0', 'Night patrol completed - all clear'],
                ['2024-03-11', '20:45', 'Suspicious Activity', 'Zone B - Loading Dock', 'Medium', 'Resolved', 'Maria Garcia', '6', 'Unidentified vehicle - owner located and verified'],
                ['2024-03-11', '16:30', 'Equipment Test', 'All Zones', 'Low', 'Completed', 'System Alert', '0', 'Weekly security system test completed'],
                ['2024-03-11', '12:00', 'Guard Check-in', 'Zone A - Main Building', 'Low', 'Completed', 'John Smith', '0', 'Midday check-in completed'],
                ['2024-03-10', '23:15', 'Alarm Triggered', 'Zone C - Storage Room', 'High', 'Resolved', 'David Brown', '4', 'Temperature alarm - HVAC system malfunction resolved'],
                ['2024-03-10', '19:20', 'Visitor Issue', 'Main Entrance', 'Low', 'Resolved', 'Sarah Johnson', '3', 'After-hours visitor - authorized access granted'],
                ['2024-03-10', '14:45', 'Patrol Completed', 'Zone B - Warehouse', 'Low', 'Completed', 'Lisa Wilson', '0', 'Afternoon patrol completed - inventory secure'],
                ['2024-03-09', '10:30', 'Security Drill', 'All Zones', 'Medium', 'Completed', 'Mike Davis', '0', 'Monthly emergency response drill conducted'],
                ['2024-03-09', '07:00', 'Guard Check-in', 'Zone A - Reception', 'Low', 'Completed', 'Emma Taylor', '0', 'Morning shift started - all systems operational']
            ];
            
            // Filter data based on selected criteria
            let filteredData = [...sampleData];
            
            // Apply date range filter
            const today = new Date();
            let startDate = new Date();
            
            if (dateRange === 'Last 7 days') {
                startDate.setDate(today.getDate() - 7);
            } else if (dateRange === 'Last 30 days') {
                startDate.setDate(today.getDate() - 30);
            } else if (dateRange === 'Last 3 months') {
                startDate.setMonth(today.getMonth() - 3);
            }
            
            filteredData = filteredData.filter(row => {
                const rowDate = new Date(row[0]);
                return rowDate >= startDate;
            });
            
            // Apply zone filter
            if (zone !== 'All Zones') {
                filteredData = filteredData.filter(row => 
                    row[3].includes(zone) || row[3] === 'All Zones'
                );
            }
            
            // Apply report type filter
            if (reportType !== 'All Reports') {
                if (reportType === 'Incident Reports') {
                    filteredData = filteredData.filter(row => 
                        ['Security Breach', 'Suspicious Activity', 'Alarm Triggered', 'Visitor Issue', 'Equipment Malfunction'].includes(row[2])
                    );
                } else if (reportType === 'Guard Performance') {
                    filteredData = filteredData.filter(row => 
                        ['Patrol Completed', 'Guard Check-in', 'Security Drill'].includes(row[2])
                    );
                } else if (reportType === 'Zone Activity') {
                    filteredData = filteredData.filter(row => 
                        row[3].includes('Zone') && !['Equipment Test', 'Security Drill'].includes(row[2])
                    );
                }
            }
            
            // Add filtered data to rows
            rows.push(...filteredData);
            
            // Add comprehensive summary statistics
            rows.push([]);
            rows.push(['SUMMARY STATISTICS']);
            rows.push(['Report Period:', dateRange]);
            rows.push(['Total Records:', filteredData.length]);
            rows.push([]);
            rows.push(['BY PRIORITY:']);
            rows.push(['High Priority:', filteredData.filter(row => row[4] === 'High').length]);
            rows.push(['Medium Priority:', filteredData.filter(row => row[4] === 'Medium').length]);
            rows.push(['Low Priority:', filteredData.filter(row => row[4] === 'Low').length]);
            rows.push([]);
            rows.push(['BY STATUS:']);
            rows.push(['Resolved:', filteredData.filter(row => row[5] === 'Resolved').length]);
            rows.push(['Completed:', filteredData.filter(row => row[5] === 'Completed').length]);
            rows.push(['Open:', filteredData.filter(row => row[5] === 'Open').length]);
            rows.push(['In Progress:', filteredData.filter(row => row[5] === 'In Progress').length]);
            rows.push(['Investigating:', filteredData.filter(row => row[5] === 'Investigating').length]);
            rows.push([]);
            rows.push(['BY TYPE:']);
            const typeCount = {};
            filteredData.forEach(row => {
                typeCount[row[2]] = (typeCount[row[2]] || 0) + 1;
            });
            Object.entries(typeCount).forEach(([type, count]) => {
                rows.push([type + ':', count]);
            });
            rows.push([]);
            rows.push(['RESPONSE TIME ANALYSIS:']);
            const responseTimes = filteredData.filter(row => row[7] && row[7] !== '0').map(row => parseInt(row[7]));
            if (responseTimes.length > 0) {
                const avgResponseTime = (responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length).toFixed(1);
                const maxResponseTime = Math.max(...responseTimes);
                const minResponseTime = Math.min(...responseTimes);
                rows.push(['Average Response Time (min):', avgResponseTime]);
                rows.push(['Maximum Response Time (min):', maxResponseTime]);
                rows.push(['Minimum Response Time (min):', minResponseTime]);
            } else {
                rows.push(['No response time data available']);
            }
            
            return rows;
        }

        function downloadCSV(data, filename) {
            // Add BOM for proper UTF-8 encoding in Excel
            const BOM = '\uFEFF';
            
            // Convert data to CSV format
            const csvContent = BOM + data.map(row => 
                row.map(cell => {
                    // Convert to string and handle special characters
                    const cellValue = String(cell || '');
                    // Escape quotes and wrap in quotes if contains comma, newline, or quotes
                    const escaped = cellValue.replace(/"/g, '""');
                    return escaped.includes(',') || escaped.includes('\n') || escaped.includes('"') || escaped.includes('\r')
                        ? `"${escaped}"` 
                        : escaped;
                }).join(',')
            ).join('\r\n'); // Use Windows line endings for better compatibility
            
            // Create blob and download
            const blob = new Blob([csvContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            
            // Create download link
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            // Add to DOM, click, and remove
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up the URL object
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
            
            console.log(`Downloaded report: ${filename}`);
        }

        // Zone Management Functions
        function renderZones() {
            const container = document.querySelector('#zonesPage .grid.grid-cols-1.md\\:grid-cols-3.lg\\:grid-cols-4.gap-6');
            if (!container) return;

            container.innerHTML = zones.map(zone => {
                const statusClass = zone.status === 'Secure' ? 'border-green-500' : 
                                  zone.status === 'Alert' ? 'border-yellow-500' : 
                                  zone.status === 'Maintenance' ? 'border-blue-500' : 'border-red-500';
                const statusBg = zone.status === 'Secure' ? 'bg-green-100 text-green-800' : 
                               zone.status === 'Alert' ? 'bg-yellow-100 text-yellow-800' : 
                               zone.status === 'Maintenance' ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800';

                return `
                    <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 ${statusClass}">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">${zone.name}</h3>
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${statusBg}">${zone.status}</span>
                        </div>
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <div class="flex justify-between">
                                <span>Type:</span>
                                <span class="font-medium">${zone.type}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Guards:</span>
                                <span class="font-medium">${zone.guards} Active</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cameras:</span>
                                <span class="font-medium">${zone.cameras} Online</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Access Points:</span>
                                <span class="font-medium">${zone.accessPoints}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Last Patrol:</span>
                                <span class="font-medium">${zone.lastPatrol}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="viewZoneDetails(${zone.id})" class="flex-1 text-blue-600 hover:text-blue-800 text-sm font-medium py-2 px-3 border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors">
                                View Details
                            </button>
                            <button onclick="editZone(${zone.id})" class="text-gray-600 hover:text-gray-800 text-sm font-medium py-2 px-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openAddZoneModal() {
            // Clear form
            document.getElementById('addZoneForm').reset();
            
            // Set default values
            document.getElementById('addZoneHoursFrom').value = '06:00';
            document.getElementById('addZoneHoursTo').value = '22:00';
            
            openModal('addZoneModal');
        }

        function handleAddZone(e) {
            e.preventDefault();
            
            // Get form data
            const name = document.getElementById('addZoneName').value.trim();
            const type = document.getElementById('addZoneType').value;
            const securityLevel = document.getElementById('addZoneSecurityLevel').value;
            const status = document.getElementById('addZoneStatus').value;
            const guards = parseInt(document.getElementById('addZoneGuards').value) || 0;
            const cameras = parseInt(document.getElementById('addZoneCameras').value) || 0;
            const accessPoints = parseInt(document.getElementById('addZoneAccessPoints').value) || 0;
            const supervisor = document.getElementById('addZoneSupervisor').value;
            const patrolFreq = document.getElementById('addZonePatrolFreq').value;
            const priority = document.getElementById('addZonePriority').value;
            const description = document.getElementById('addZoneDescription').value.trim();
            const instructions = document.getElementById('addZoneInstructions').value.trim();
            
            // Collect security features
            const features = [];
            if (document.getElementById('featureCCTV').checked) features.push('CCTV Monitoring');
            if (document.getElementById('featureAccessControl').checked) features.push('Access Control');
            if (document.getElementById('featureMotionSensors').checked) features.push('Motion Sensors');
            if (document.getElementById('featureAlarmSystem').checked) features.push('Alarm System');
            if (document.getElementById('featureFireSafety').checked) features.push('Fire Safety');
            if (document.getElementById('featureEmergencyExit').checked) features.push('Emergency Exits');
            
            // Create new zone object
            const newZone = {
                id: Math.max(...zones.map(z => z.id)) + 1,
                name: name,
                type: type,
                status: status,
                guards: guards,
                cameras: cameras,
                accessPoints: accessPoints,
                lastPatrol: guards > 0 ? 'Just now' : 'No patrol assigned',
                securityLevel: securityLevel,
                supervisor: supervisor,
                description: description,
                patrolFreq: patrolFreq,
                priority: priority,
                features: features,
                instructions: instructions
            };
            
            // Add to zones array
            zones.push(newZone);
            
            // Simulate form submission delay
            setTimeout(() => {
                closeModal('addZoneModal');
                showNotification(`${name} has been created successfully!`, 'success');
                
                // Re-render zones if visible
                const zonesPage = document.getElementById('zonesPage');
                if (zonesPage && !zonesPage.classList.contains('hidden')) {
                    renderZones();
                }
                
                // Update dashboard stats
                updateZoneStats();
            }, 500);
        }

        function viewZoneDetails(zoneId) {
            const zone = zones.find(z => z.id === zoneId);
            if (zone) {
                // Populate the zone details modal
                document.getElementById('viewZoneName').textContent = zone.name;
                document.getElementById('viewZoneType').textContent = zone.type;
                document.getElementById('viewZoneId').textContent = `ZONE-${zone.id.toString().padStart(3, '0')}`;
                document.getElementById('viewZoneSecurityLevel').textContent = zone.securityLevel;
                
                // Set status with appropriate styling
                const statusElement = document.getElementById('viewZoneStatus');
                statusElement.textContent = zone.status;
                const statusClass = zone.status === 'Secure' ? 'bg-green-100 text-green-800' : 
                                  zone.status === 'Alert' ? 'bg-yellow-100 text-yellow-800' : 
                                  zone.status === 'Maintenance' ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800';
                statusElement.className = `px-3 py-1 rounded-full text-sm ${statusClass}`;
                
                // Set priority with appropriate styling
                const priorityElement = document.getElementById('viewZonePriority');
                priorityElement.textContent = zone.priority || 'Medium';
                const priorityClass = (zone.priority === 'Critical' || zone.priority === 'High') ? 'bg-red-100 text-red-800' : 
                                    zone.priority === 'Medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                priorityElement.className = `px-2 py-1 text-sm rounded-full ${priorityClass}`;
                
                // Populate resource information
                document.getElementById('viewZoneGuards').textContent = zone.guards;
                document.getElementById('viewZoneCameras').textContent = zone.cameras;
                document.getElementById('viewZoneAccessPoints').textContent = zone.accessPoints;
                document.getElementById('viewZoneLastPatrol').textContent = zone.lastPatrol;
                document.getElementById('viewZoneSupervisor').textContent = zone.supervisor || 'Not assigned';
                document.getElementById('viewZonePatrolFreq').textContent = zone.patrolFreq || 'Every hour';
                
                // Populate description and instructions
                document.getElementById('viewZoneDescription').textContent = zone.description || 'No description available';
                document.getElementById('viewZoneInstructions').textContent = zone.instructions || 'No special instructions';
                
                // Populate security features
                const featuresContainer = document.getElementById('viewZoneFeatures');
                const features = zone.features || ['CCTV Monitoring', 'Access Control', 'Motion Sensors'];
                featuresContainer.innerHTML = features.map(feature => {
                    const iconMap = {
                        'CCTV Monitoring': 'fa-video',
                        'Access Control': 'fa-key',
                        'Motion Sensors': 'fa-radar',
                        'Alarm System': 'fa-bell',
                        'Fire Safety': 'fa-fire-extinguisher',
                        'Emergency Exits': 'fa-door-open'
                    };
                    const icon = iconMap[feature] || 'fa-shield-alt';
                    return `
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                            <i class="fas ${icon} text-blue-600 mr-3"></i>
                            <span class="text-sm font-medium text-gray-900">${feature}</span>
                            <span class="ml-auto text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Active</span>
                        </div>
                    `;
                }).join('');
                
                // Generate recent activity
                const activityContainer = document.getElementById('viewZoneActivity');
                const activities = [
                    { type: 'patrol', message: 'Patrol completed successfully', time: zone.lastPatrol, icon: 'fa-walking', color: 'green' },
                    { type: 'checkin', message: 'Guard check-in completed', time: '1 hour ago', icon: 'fa-user-check', color: 'blue' },
                    { type: 'system', message: 'All cameras operational', time: '2 hours ago', icon: 'fa-video', color: 'green' },
                    { type: 'access', message: 'Access control system tested', time: '4 hours ago', icon: 'fa-key', color: 'blue' },
                    { type: 'maintenance', message: 'Routine maintenance completed', time: '1 day ago', icon: 'fa-tools', color: 'gray' }
                ];
                
                activityContainer.innerHTML = activities.map(activity => `
                    <div class="flex items-start">
                        <div class="w-2 h-2 bg-${activity.color}-500 rounded-full mt-2 mr-3"></div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900">${activity.message}</p>
                            <p class="text-xs text-gray-500">${activity.time}</p>
                        </div>
                    </div>
                `).join('');
                
                // Generate performance metrics
                const performanceMetrics = {
                    uptime: Math.floor(Math.random() * 5) + 95,
                    incidents: Math.floor(Math.random() * 3),
                    responseTime: Math.floor(Math.random() * 5) + 3,
                    efficiency: Math.floor(Math.random() * 10) + 90
                };
                
                document.getElementById('zoneUptime').textContent = performanceMetrics.uptime + '%';
                document.getElementById('zoneIncidents').textContent = performanceMetrics.incidents;
                document.getElementById('zoneResponseTime').textContent = performanceMetrics.responseTime + ' min';
                document.getElementById('zoneEfficiency').textContent = performanceMetrics.efficiency + '%';
                
                // Store zone ID for actions
                document.getElementById('viewZoneModal').dataset.zoneId = zoneId;
                
                // Open the modal
                openModal('viewZoneModal');
            }
        }

        function editZone(zoneId) {
            const zone = zones.find(z => z.id === zoneId);
            if (zone) {
                // Populate the edit form with zone data
                document.getElementById('editZoneName').value = zone.name;
                document.getElementById('editZoneType').value = zone.type;
                document.getElementById('editZoneSecurityLevel').value = zone.securityLevel;
                document.getElementById('editZoneStatus').value = zone.status;
                document.getElementById('editZoneGuards').value = zone.guards;
                document.getElementById('editZoneCameras').value = zone.cameras;
                document.getElementById('editZoneAccessPoints').value = zone.accessPoints;
                document.getElementById('editZoneSupervisor').value = zone.supervisor || '';
                document.getElementById('editZonePatrolFreq').value = zone.patrolFreq || 'Every hour';
                document.getElementById('editZonePriority').value = zone.priority || 'Medium';
                document.getElementById('editZoneDescription').value = zone.description || '';
                document.getElementById('editZoneInstructions').value = zone.instructions || '';
                
                // Set operating hours
                document.getElementById('editZoneHoursFrom').value = '06:00';
                document.getElementById('editZoneHoursTo').value = '22:00';
                document.getElementById('editZone24Hours').checked = false;
                
                // Set security features
                const features = zone.features || ['CCTV Monitoring', 'Access Control', 'Motion Sensors'];
                document.getElementById('editFeatureCCTV').checked = features.includes('CCTV Monitoring');
                document.getElementById('editFeatureAccessControl').checked = features.includes('Access Control');
                document.getElementById('editFeatureMotionSensors').checked = features.includes('Motion Sensors');
                document.getElementById('editFeatureAlarmSystem').checked = features.includes('Alarm System');
                document.getElementById('editFeatureFireSafety').checked = features.includes('Fire Safety');
                document.getElementById('editFeatureEmergencyExit').checked = features.includes('Emergency Exits');
                
                // Store zone ID for form submission
                document.getElementById('editZoneForm').dataset.zoneId = zoneId;
                
                // Open the modal
                openModal('editZoneModal');
            }
        }

        function handleEditZone(e) {
            e.preventDefault();
            
            const zoneId = parseInt(e.target.dataset.zoneId);
            const zone = zones.find(z => z.id === zoneId);
            
            if (zone) {
                // Update zone data
                zone.name = document.getElementById('editZoneName').value.trim();
                zone.type = document.getElementById('editZoneType').value;
                zone.securityLevel = document.getElementById('editZoneSecurityLevel').value;
                zone.status = document.getElementById('editZoneStatus').value;
                zone.guards = parseInt(document.getElementById('editZoneGuards').value) || 0;
                zone.cameras = parseInt(document.getElementById('editZoneCameras').value) || 0;
                zone.accessPoints = parseInt(document.getElementById('editZoneAccessPoints').value) || 0;
                zone.supervisor = document.getElementById('editZoneSupervisor').value;
                zone.patrolFreq = document.getElementById('editZonePatrolFreq').value;
                zone.priority = document.getElementById('editZonePriority').value;
                zone.description = document.getElementById('editZoneDescription').value.trim();
                zone.instructions = document.getElementById('editZoneInstructions').value.trim();
                
                // Update security features
                const features = [];
                if (document.getElementById('editFeatureCCTV').checked) features.push('CCTV Monitoring');
                if (document.getElementById('editFeatureAccessControl').checked) features.push('Access Control');
                if (document.getElementById('editFeatureMotionSensors').checked) features.push('Motion Sensors');
                if (document.getElementById('editFeatureAlarmSystem').checked) features.push('Alarm System');
                if (document.getElementById('editFeatureFireSafety').checked) features.push('Fire Safety');
                if (document.getElementById('editFeatureEmergencyExit').checked) features.push('Emergency Exits');
                zone.features = features;
                
                // Simulate form submission delay
                setTimeout(() => {
                    closeModal('editZoneModal');
                    showNotification(`${zone.name} has been updated successfully!`, 'success');
                    
                    // Re-render zones if visible
                    const zonesPage = document.getElementById('zonesPage');
                    if (zonesPage && !zonesPage.classList.contains('hidden')) {
                        renderZones();
                    }
                    
                    // Update zone stats
                    updateZoneStats();
                    
                    // If the view modal was open, update it with new data
                    const viewModal = document.getElementById('viewZoneModal');
                    if (viewModal && !viewModal.classList.contains('hidden')) {
                        // Small delay then reopen view modal with updated data
                        setTimeout(() => {
                            viewZoneDetails(zoneId);
                        }, 300);
                    }
                }, 500);
            }
        }

        function updateZoneStats() {
            // Update any zone-related statistics in the dashboard
            const secureZones = zones.filter(z => z.status === 'Secure').length;
            const alertZones = zones.filter(z => z.status === 'Alert').length;
            const totalZones = zones.length;
            
            // Update dashboard zone count if visible
            const dashboardPage = document.getElementById('dashboardPage');
            if (dashboardPage && !dashboardPage.classList.contains('hidden')) {
                const zoneStatElement = dashboardPage.querySelector('.text-2xl.font-bold.text-gray-900');
                if (zoneStatElement && zoneStatElement.textContent === '12') {
                    zoneStatElement.textContent = totalZones;
                }
            }
        }

        function editZoneFromView() {
            const zoneId = document.getElementById('viewZoneModal').dataset.zoneId;
            if (zoneId) {
                // Close the view modal first
                closeModal('viewZoneModal');
                
                // Small delay to ensure smooth transition
                setTimeout(() => {
                    editZone(parseInt(zoneId));
                }, 200);
            }
        }

        function generateZoneReport() {
            const zoneId = document.getElementById('viewZoneModal').dataset.zoneId;
            const zone = zones.find(z => z.id === parseInt(zoneId));
            
            if (zone) {
                // Show loading state
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
                btn.disabled = true;
                
                // Simulate report generation
                setTimeout(() => {
                    // Generate zone-specific report data
                    const reportData = generateZoneReportData(zone);
                    
                    // Create and download CSV file
                    downloadCSV(reportData, `${zone.name}-Security-Report-${new Date().toISOString().split('T')[0]}.csv`);
                    
                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    
                    showNotification(`Security report for ${zone.name} downloaded successfully!`, 'success');
                }, 1500);
            }
        }

        function generateZoneReportData(zone) {
            const headers = ['Date', 'Time', 'Activity Type', 'Details', 'Guard', 'Status', 'Notes'];
            const rows = [headers];
            
            // Add report metadata
            rows.push([`${zone.name.toUpperCase()} SECURITY REPORT`]);
            rows.push(['Generated:', new Date().toLocaleString()]);
            rows.push(['Zone:', zone.name]);
            rows.push(['Type:', zone.type]);
            rows.push(['Security Level:', zone.securityLevel]);
            rows.push(['Status:', zone.status]);
            rows.push(['Supervisor:', zone.supervisor || 'Not assigned']);
            rows.push(['Generated By:', currentUser ? currentUser.fullName : 'System Administrator']);
            rows.push([]);
            rows.push(['ZONE ACTIVITY LOG']);
            rows.push(headers);
            
            // Generate sample activity data for the zone
            const activities = [
                ['2024-03-15', '14:30', 'Patrol Completed', 'Routine patrol round completed successfully', 'John Smith', 'Completed', 'All areas secure'],
                ['2024-03-15', '14:00', 'Guard Check-in', 'Scheduled check-in at main checkpoint', 'John Smith', 'Completed', 'No issues reported'],
                ['2024-03-15', '13:30', 'Camera Check', 'All security cameras operational', 'System Alert', 'Completed', 'Full coverage maintained'],
                ['2024-03-15', '13:00', 'Access Control Test', 'Door access systems tested', 'Sarah Johnson', 'Completed', 'All systems functional'],
                ['2024-03-15', '12:30', 'Patrol Completed', 'Perimeter patrol completed', 'Mike Davis', 'Completed', 'No anomalies detected'],
                ['2024-03-15', '12:00', 'Guard Check-in', 'Midday security check', 'Mike Davis', 'Completed', 'Zone secure'],
                ['2024-03-15', '11:30', 'Visitor Log', 'Authorized visitor entry recorded', 'John Smith', 'Completed', 'Proper identification verified'],
                ['2024-03-15', '11:00', 'Equipment Check', 'Security equipment inspection', 'System Alert', 'Completed', 'All equipment operational'],
                ['2024-03-15', '10:30', 'Patrol Completed', 'Morning patrol round completed', 'Sarah Johnson', 'Completed', 'Area clear'],
                ['2024-03-15', '10:00', 'Guard Check-in', 'Morning check-in completed', 'Sarah Johnson', 'Completed', 'Shift started successfully']
            ];
            
            // Add activity data
            rows.push(...activities);
            
            // Add zone statistics
            rows.push([]);
            rows.push(['ZONE STATISTICS']);
            rows.push(['Total Guards:', zone.guards]);
            rows.push(['Security Cameras:', zone.cameras]);
            rows.push(['Access Points:', zone.accessPoints]);
            rows.push(['Last Patrol:', zone.lastPatrol]);
            rows.push(['Patrol Frequency:', zone.patrolFreq || 'Every hour']);
            rows.push(['Priority Level:', zone.priority || 'Medium']);
            rows.push([]);
            rows.push(['SECURITY FEATURES']);
            const features = zone.features || ['CCTV Monitoring', 'Access Control', 'Motion Sensors'];
            features.forEach(feature => {
                rows.push([feature, 'Active']);
            });
            
            return rows;
        }

        function schedulePatrol() {
            const zoneId = document.getElementById('viewZoneModal').dataset.zoneId;
            const zone = zones.find(z => z.id === parseInt(zoneId));
            
            if (zone) {
                // Show loading state
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Scheduling...';
                btn.disabled = true;
                
                // Simulate patrol scheduling
                setTimeout(() => {
                    // Update zone's last patrol time
                    zone.lastPatrol = 'Scheduled for next 15 min';
                    
                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    
                    showNotification(`Patrol scheduled for ${zone.name}. Guards will be notified.`, 'success');
                    
                    // Update the display
                    document.getElementById('viewZoneLastPatrol').textContent = zone.lastPatrol;
                    
                    // Re-render zones if visible
                    const zonesPage = document.getElementById('zonesPage');
                    if (zonesPage && !zonesPage.classList.contains('hidden')) {
                        renderZones();
                    }
                    
                    // Simulate patrol completion after some time
                    setTimeout(() => {
                        zone.lastPatrol = 'Just completed';
                        showNotification(`Patrol completed for ${zone.name}`, 'success');
                        
                        // Update displays
                        const lastPatrolElement = document.getElementById('viewZoneLastPatrol');
                        if (lastPatrolElement) {
                            lastPatrolElement.textContent = zone.lastPatrol;
                        }
                        
                        // Re-render zones if visible
                        if (zonesPage && !zonesPage.classList.contains('hidden')) {
                            renderZones();
                        }
                    }, 10000); // Simulate 10 second patrol
                }, 1000);
            }
        }

        // Helper functions for incident management
        function getAvailablePersonnel() {
            // Return available security personnel for assignment
            return [
                { id: 1, name: 'John Smith', role: 'Senior Security Officer', department: 'Zone A Security', status: 'available', expertise: ['Security Breach', 'Patrol'], phone: '(555) 123-4567' },
                { id: 2, name: 'Sarah Johnson', role: 'Security Supervisor', department: 'Zone B Security', status: 'available', expertise: ['Incident Management', 'Investigation'], phone: '(555) 234-5678' },
                { id: 3, name: 'Mike Davis', role: 'Security Manager', department: 'Security Office', status: 'available', expertise: ['Emergency Response', 'Coordination'], phone: '(555) 345-6789' },
                { id: 4, name: 'Lisa Wilson', role: 'Security Officer', department: 'Zone C Security', status: 'available', expertise: ['Patrol', 'Access Control'], phone: '(555) 456-7890' },
                { id: 5, name: 'David Brown', role: 'Security Analyst', department: 'Security Operations', status: 'available', expertise: ['Investigation', 'Analysis'], phone: '(555) 567-8901' },
                { id: 6, name: 'Emma Taylor', role: 'Security Officer', department: 'Perimeter Security', status: 'available', expertise: ['Patrol', 'Surveillance'], phone: '(555) 678-9012' }
            ];
        }

        function getEmergencyPersonnel() {
            // Return emergency response personnel for high-priority incidents
            return [
                { id: 7, name: 'James Wilson', role: 'Emergency Response Leader', department: 'Emergency Response', status: 'on-call', expertise: ['Crisis Management', 'Emergency Protocols'], phone: '(555) 789-0123' },
                { id: 8, name: 'Maria Garcia', role: 'Security Specialist', department: 'Special Operations', status: 'on-call', expertise: ['Threat Assessment', 'Security Breach'], phone: '(555) 890-1234' }
            ];
        }

        function autoAssignPersonnel(incident, availablePersonnel) {
            const assignment = [];
            
            // Assign based on incident type and priority
            if (incident.type === 'Security Breach') {
                // High priority security breach - assign multiple personnel
                if (incident.priority === 'high') {
                    assignment.push(
                        availablePersonnel.find(p => p.expertise.includes('Security Breach')),
                        availablePersonnel.find(p => p.role.includes('Supervisor')),
                        availablePersonnel.find(p => p.role.includes('Manager'))
                    );
                } else {
                    assignment.push(availablePersonnel.find(p => p.expertise.includes('Security Breach')));
                }
            } else if (incident.type === 'Suspicious Activity') {
                // Assign investigation specialist
                assignment.push(
                    availablePersonnel.find(p => p.expertise.includes('Investigation')),
                    availablePersonnel.find(p => p.expertise.includes('Patrol'))
                );
            } else if (incident.type === 'Equipment Malfunction') {
                // Assign technical specialist and patrol officer
                assignment.push(
                    availablePersonnel.find(p => p.expertise.includes('Analysis')),
                    availablePersonnel.find(p => p.expertise.includes('Patrol'))
                );
            } else {
                // Default assignment - patrol officer and supervisor if high priority
                assignment.push(availablePersonnel.find(p => p.expertise.includes('Patrol')));
                if (incident.priority === 'high') {
                    assignment.push(availablePersonnel.find(p => p.role.includes('Supervisor')));
                }
            }
            
            // Filter out null values and ensure unique assignments
            return assignment.filter((person, index, self) => 
                person && self.findIndex(p => p && p.id === person.id) === index
            );
        }

        function updateIncidentPersonnelDisplay(incident) {
            const personnelContainer = document.getElementById('incidentPersonnel');
            if (personnelContainer && incident.assignedPersonnel) {
                personnelContainer.innerHTML = incident.assignedPersonnel.map(person => {
                    const roleClass = person.role.includes('Manager') ? 'bg-purple-100 text-purple-800' :
                                     person.role.includes('Supervisor') ? 'bg-blue-100 text-blue-800' :
                                     person.role.includes('Leader') ? 'bg-red-100 text-red-800' :
                                     'bg-green-100 text-green-800';
                    
                    const roleLabel = person.role.includes('Manager') ? 'Manager' :
                                     person.role.includes('Supervisor') ? 'Supervisor' :
                                     person.role.includes('Leader') ? 'Emergency' :
                                     person.assignedBy === 'Auto-assigned (Escalation)' ? 'Emergency' : 'Primary';
                    
                    return `
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                            <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                <span class="text-sm font-medium text-blue-600">${person.name.split(' ').map(n => n[0]).join('')}</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">${person.name}</p>
                                <p class="text-xs text-gray-500">${person.role} • ${person.department}</p>
                                <p class="text-xs text-gray-400">Assigned: ${person.assignedAt}</p>
                            </div>
                            <span class="text-xs px-2 py-1 rounded-full ${roleClass}">${roleLabel}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateIncidentDetailsDisplay(incident) {
            // Update priority display
            const priorityElement = document.getElementById('incidentDetailPriority');
            if (priorityElement) {
                priorityElement.textContent = incident.priority.toUpperCase();
                const priorityClass = incident.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                   incident.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                priorityElement.className = `px-3 py-1 text-sm font-medium rounded-full ${priorityClass}`;
            }
            
            // Update status display
            const statusElement = document.getElementById('incidentDetailStatus');
            if (statusElement) {
                statusElement.textContent = incident.status.toUpperCase().replace('_', ' ');
                const statusClass = incident.status === 'open' ? 'bg-red-100 text-red-800' : 
                                  incident.status === 'investigating' ? 'bg-blue-100 text-blue-800' : 
                                  incident.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' :
                                  'bg-green-100 text-green-800';
                statusElement.className = `px-3 py-1 text-sm font-medium rounded-full ml-2 ${statusClass}`;
            }
            
            // Update personnel display
            updateIncidentPersonnelDisplay(incident);
            
            // Update timeline with new entries
            updateIncidentTimeline(incident);
        }

        function updateIncidentTimeline(incident) {
            const timelineContainer = document.getElementById('incidentTimeline');
            if (timelineContainer && incident.history) {
                // Get the latest history entries
                const recentHistory = incident.history.slice(-3);
                
                // Add new timeline entries
                recentHistory.forEach(entry => {
                    if (entry.action === 'Personnel Assigned') {
                        const timelineEntry = document.createElement('div');
                        timelineEntry.className = 'flex items-start';
                        timelineEntry.innerHTML = `
                            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3"></div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">Personnel Assigned</p>
                                <p class="text-xs text-gray-500">${entry.assignedPersonnel} • ${entry.timestamp}</p>
                            </div>
                        `;
                        timelineContainer.appendChild(timelineEntry);
                    } else if (entry.action === 'Incident Escalated') {
                        const timelineEntry = document.createElement('div');
                        timelineEntry.className = 'flex items-start';
                        timelineEntry.innerHTML = `
                            <div class="w-2 h-2 bg-red-500 rounded-full mt-2 mr-3"></div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">Incident Escalated</p>
                                <p class="text-xs text-gray-500">${entry.escalationLevel} • ${entry.timestamp}</p>
                            </div>
                        `;
                        timelineContainer.appendChild(timelineEntry);
                    }
                });
            }
        }

        // Real-time updates simulation
        setInterval(() => {
            // Update guard locations randomly
            guards.forEach(guard => {
                if (Math.random() < 0.1) { // 10% chance to update
                    guard.lastCheckin = Math.floor(Math.random() * 10) + 1 + ' min ago';
                }
            });
            
            // Re-render guards table if visible
            const guardsPage = document.getElementById('guardsPage');
            if (guardsPage && !guardsPage.classList.contains('hidden')) {
                renderGuards();
            }
        }, 30000); // Update every 30 seconds

        // Responsive handling
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96dafe5a553d9345',t:'MTc1NDk0OTQ5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
