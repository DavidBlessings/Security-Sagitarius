<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sagittarius Security Services - Security Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .login-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen login-bg flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <!-- Floating Security Icons -->
            <div class="absolute top-20 left-20 text-6xl opacity-10 floating-animation" style="animation-delay: 0s;">üõ°Ô∏è</div>
            <div class="absolute top-40 right-32 text-4xl opacity-10 floating-animation" style="animation-delay: 2s;">üîí</div>
            <div class="absolute bottom-32 left-32 text-5xl opacity-10 floating-animation" style="animation-delay: 4s;">üëÆ</div>
            <div class="absolute bottom-20 right-20 text-3xl opacity-10 floating-animation" style="animation-delay: 1s;">‚ö†Ô∏è</div>
            
            <div class="bg-white rounded-2xl shadow-2xl p-8 relative z-10">
                <!-- Logo and Title -->
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl text-white">üõ°Ô∏è</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Sagittarius Security</h1>
                    <p class="text-gray-600 mt-1">Security Management System</p>
                </div>

                <!-- Login Form -->
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Employee ID or Email</label>
                            <div class="relative">
                                <input type="text" id="login-username" required 
                                       class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       placeholder="Enter your Employee ID or Email">
                                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="login-password" required 
                                       class="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       placeholder="Enter your password">
                                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                </div>
                                <button type="button" onclick="togglePassword()" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <svg id="eye-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <label class="flex items-center">
                                <input type="checkbox" id="remember-me" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-600">Remember me</span>
                            </label>
                            <a href="#" onclick="showForgotPassword()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                Forgot password?
                            </a>
                        </div>

                        <button type="submit" id="login-btn" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            <span id="login-btn-text">Sign In</span>
                            <svg id="login-spinner" class="hidden animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>

                        <!-- Error Message -->
                        <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                                <span id="login-error-text">Invalid credentials. Please try again.</span>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Footer -->
                <div class="mt-8 text-center text-sm text-gray-500">
                    <p>¬© 2024 Sagittarius Security Services</p>
                    <p class="mt-1">Secure ‚Ä¢ Reliable ‚Ä¢ Professional</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-semibold">Reset Password</h4>
                    <button onclick="hideForgotPassword()" class="text-gray-400 hover:text-gray-600">‚úï</button>
                </div>
                <form id="forgot-password-form" onsubmit="handleForgotPassword(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Employee ID or Email</label>
                            <input type="text" id="forgot-username" required 
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Enter your Employee ID or Email">
                        </div>
                        <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg text-sm">
                            <p>A password reset link will be sent to your registered email address.</p>
                        </div>
                    </div>
                    <div class="flex space-x-3 mt-6">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition-colors">
                            Send Reset Link
                        </button>
                        <button type="button" onclick="hideForgotPassword()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg font-medium transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden initially) -->
    <div id="main-app" class="hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-slate-800 text-white z-50 sidebar-transition">
            <div class="p-6 border-b border-slate-700">
                <h1 class="text-xl font-bold text-blue-400">üõ°Ô∏è Sagittarius Security Services</h1>
                <p class="text-sm text-slate-300 mt-1">Security Management</p>
            </div>
            
            <nav class="mt-6">
                <a href="#" onclick="showSection('dashboard')" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">
                    <span class="mr-3">üìä</span> Dashboard
                </a>
                <a href="#" onclick="showSection('incidents')" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">
                    <span class="mr-3">‚ö†Ô∏è</span> Incident Reports
                </a>
                <a href="#" onclick="showSection('guards')" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">
                    <span class="mr-3">üëÆ</span> Guard Tracking
                </a>
                <a href="#" onclick="showSection('users')" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">
                    <span class="mr-3">üë•</span> User Management
                </a>
                <a href="#" onclick="showSection('settings')" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">
                    <span class="mr-3">‚öôÔ∏è</span> Settings
                </a>
            </nav>

            <!-- User Profile Section -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-slate-700">
                <div class="flex items-center space-x-3 mb-3">
                    <div id="user-avatar" class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium">
                        <!-- User initials will be set here -->
                    </div>
                    <div class="flex-1 min-w-0">
                        <p id="user-name" class="text-sm font-medium text-white truncate">
                            <!-- User name will be set here -->
                        </p>
                        <p id="user-role" class="text-xs text-slate-300 truncate">
                            <!-- User role will be set here -->
                        </p>
                    </div>
                </div>
                <button onclick="handleLogout()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors flex items-center justify-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Logout
                </button>
            </div>
        </div>

        <!-- Mobile menu button -->
        <button id="mobile-menu-btn" class="lg:hidden fixed top-4 left-4 z-50 bg-slate-800 text-white p-2 rounded-md">
            <span class="block w-6 h-0.5 bg-white mb-1"></span>
            <span class="block w-6 h-0.5 bg-white mb-1"></span>
            <span class="block w-6 h-0.5 bg-white"></span>
        </button>

        <!-- Main Content -->
        <div class="lg:ml-64 min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 p-4">
                <div class="flex justify-between items-center">
                    <h2 id="page-title" class="text-2xl font-semibold text-gray-800">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Last updated: <span id="last-updated"></span></span>
                        <div class="flex items-center space-x-2">
                            <div id="header-user-avatar" class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium">
                                <!-- User initials will be set here -->
                            </div>
                            <span id="header-user-name" class="text-sm font-medium text-gray-700">
                                <!-- User name will be set here -->
                            </span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section-content p-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Active Guards</p>
                                <p class="text-3xl font-bold text-green-600">12</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üëÆ</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Open Incidents</p>
                                <p class="text-3xl font-bold text-red-600">3</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">‚ö†Ô∏è</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Zones Secured</p>
                                <p class="text-3xl font-bold text-blue-600">8/10</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üè¢</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">System Status</p>
                                <p class="text-lg font-bold text-green-600">Operational</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">‚úÖ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Incident Trends</h3>
                        <canvas id="incidentChart" width="400" height="200"></canvas>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="text-green-500">‚úÖ</span>
                                <div>
                                    <p class="text-sm font-medium">Guard check-in: Zone A</p>
                                    <p class="text-xs text-gray-500">2 minutes ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="text-yellow-500">‚ö†Ô∏è</span>
                                <div>
                                    <p class="text-sm font-medium">Minor incident reported</p>
                                    <p class="text-xs text-gray-500">15 minutes ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <span class="text-blue-500">üîÑ</span>
                                <div>
                                    <p class="text-sm font-medium">Shift change completed</p>
                                    <p class="text-xs text-gray-500">1 hour ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections remain the same as in the previous code -->
            <!-- Incident Reports Section -->
            <div id="incidents-section" class="section-content p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Incident Management</h3>
                    <button onclick="showIncidentForm()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        + Report Incident
                    </button>
                </div>

                <!-- Incident Form Modal -->
                <div id="incident-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold">Report New Incident</h4>
                                <button onclick="hideIncidentForm()" class="text-gray-400 hover:text-gray-600">‚úï</button>
                            </div>
                            <form id="incident-form" onsubmit="submitIncident(event)">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Incident Type</label>
                                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                            <option>Security Breach</option>
                                            <option>Suspicious Activity</option>
                                            <option>Equipment Malfunction</option>
                                            <option>Medical Emergency</option>
                                            <option>Fire/Safety</option>
                                            <option>Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                        <input type="text" placeholder="Building, Floor, Room" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                            <option>High</option>
                                            <option>Medium</option>
                                            <option>Low</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <textarea rows="3" placeholder="Describe the incident..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"></textarea>
                                    </div>
                                </div>
                                <div class="flex space-x-3 mt-6">
                                    <button type="submit" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-medium transition-colors">
                                        Submit Report
                                    </button>
                                    <button type="button" onclick="hideIncidentForm()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg font-medium transition-colors">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Incidents List -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">ID</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Type</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Location</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Priority</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Status</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Time</th>
                                    </tr>
                                </thead>
                                <tbody id="incidents-table">
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4">#001</td>
                                        <td class="py-3 px-4">Security Breach</td>
                                        <td class="py-3 px-4">Building A, Floor 3</td>
                                        <td class="py-3 px-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">High</span></td>
                                        <td class="py-3 px-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">In Progress</span></td>
                                        <td class="py-3 px-4">10:30 AM</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4">#002</td>
                                        <td class="py-3 px-4">Suspicious Activity</td>
                                        <td class="py-3 px-4">Parking Lot B</td>
                                        <td class="py-3 px-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">Medium</span></td>
                                        <td class="py-3 px-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">Resolved</span></td>
                                        <td class="py-3 px-4">09:15 AM</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guard Tracking Section -->
            <div id="guards-section" class="section-content p-6 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Guard Tracking & Management</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Guard List -->
                    <div class="lg:col-span-2 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Active Guards</h4>
                        <div class="space-y-4" id="guards-list">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-medium">JD</div>
                                    <div>
                                        <p class="font-medium text-gray-800">John Doe</p>
                                        <p class="text-sm text-gray-600">Zone A - Main Entrance</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                    <span class="text-sm text-green-600 font-medium">On Duty</span>
                                    <p class="text-xs text-gray-500">Last check: 2 min ago</p>
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium">MS</div>
                                    <div>
                                        <p class="font-medium text-gray-800">Maria Santos</p>
                                        <p class="text-sm text-gray-600">Zone B - Parking Garage</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                    <span class="text-sm text-green-600 font-medium">On Duty</span>
                                    <p class="text-xs text-gray-500">Last check: 5 min ago</p>
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-medium">RJ</div>
                                    <div>
                                        <p class="font-medium text-gray-800">Robert Johnson</p>
                                        <p class="text-sm text-gray-600">Zone C - Back Entrance</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>
                                    <span class="text-sm text-yellow-600 font-medium">On Break</span>
                                    <p class="text-xs text-gray-500">Break started: 10 min ago</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Guard Actions -->
                    <div class="space-y-6">
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h4>
                            <div class="space-y-3">
                                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Send Alert to All Guards
                                </button>
                                <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Request Status Update
                                </button>
                                <button class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Schedule Patrol Route
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">Zone Coverage</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Zone A</span>
                                    <span class="text-sm font-medium text-green-600">‚úÖ Covered</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Zone B</span>
                                    <span class="text-sm font-medium text-green-600">‚úÖ Covered</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Zone C</span>
                                    <span class="text-sm font-medium text-yellow-600">‚ö†Ô∏è On Break</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Zone D</span>
                                    <span class="text-sm font-medium text-red-600">‚ùå Uncovered</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Section -->
            <div id="users-section" class="section-content p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">User Management</h3>
                    <button onclick="showUserForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        + Add User
                    </button>
                </div>

                <!-- Privileges View Modal -->
                <div id="privileges-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 id="privileges-modal-title" class="text-lg font-semibold">User Privileges</h4>
                                <button onclick="hidePrivilegesModal()" class="text-gray-400 hover:text-gray-600">‚úï</button>
                            </div>
                            <div id="privileges-content" class="space-y-3">
                                <!-- Privileges will be displayed here -->
                            </div>
                            <div class="mt-6">
                                <button onclick="hidePrivilegesModal()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg font-medium transition-colors">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Modal -->
                <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 id="user-modal-title" class="text-lg font-semibold">Add New User</h4>
                                <button onclick="hideUserForm()" class="text-gray-400 hover:text-gray-600">‚úï</button>
                            </div>
                            <form id="user-form" onsubmit="submitUser(event)">
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                            <input type="text" name="firstName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                            <input type="text" name="lastName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" name="email" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                                        <select name="role" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select Role</option>
                                            <option value="Admin">Administrator</option>
                                            <option value="Guard">Security Guard</option>
                                            <option value="Supervisor">Supervisor</option>
                                            <option value="Head of Operations">Head of Operations</option>
                                            <option value="IT Support">IT Support</option>
                                            <option value="Accountant">Accountant</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                                        <select name="department" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select Department</option>
                                            <option value="Operations">Operations</option>
                                            <option value="IT">IT Support</option>
                                            <option value="Finance">Finance</option>
                                            <option value="HR">HR</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                        <input type="tel" name="phone" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Employee ID</label>
                                        <input type="text" name="employeeId" readonly class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-50 text-gray-600 cursor-not-allowed">
                                        <p class="text-xs text-gray-500 mt-1">Auto-generated (SSS-GH0001, SSS-GH0002, etc.)</p>
                                    </div>
                                    <div id="location-field" class="hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Assigned Location/Zone</label>
                                        <input type="text" name="location" placeholder="Enter location (e.g., Zone A - Main Entrance, Building 2 - Floor 3)" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="isActive" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span class="ml-2 text-sm text-gray-700">Active User</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="canLogin" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span class="ml-2 text-sm text-gray-700">Can Login</span>
                                        </label>
                                    </div>
                                    
                                    <!-- Privileges Section -->
                                    <div class="border-t border-gray-200 pt-4">
                                        <h5 class="text-sm font-semibold text-gray-800 mb-3">System Privileges</h5>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="dashboard_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Dashboard</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="incidents_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Incidents</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="incidents_create" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Create Incidents</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="incidents_edit" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Edit Incidents</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="guards_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Guard Tracking</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="guards_manage" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Manage Guards</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="users_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Users</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="users_manage" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Manage Users</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="reports_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Reports</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="reports_export" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Export Reports</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="settings_view" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">View Settings</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="settings_manage" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Manage Settings</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="alerts_send" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">Send Alerts</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" name="privileges" value="system_admin" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-700">System Administration</span>
                                            </label>
                                        </div>
                                        
                                        <div class="mt-4 flex space-x-2">
                                            <button type="button" onclick="selectAllPrivileges()" class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-md font-medium transition-colors">
                                                Select All
                                            </button>
                                            <button type="button" onclick="clearAllPrivileges()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-md font-medium transition-colors">
                                                Clear All
                                            </button>
                                            <button type="button" onclick="setRolePrivileges()" class="text-xs bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-md font-medium transition-colors">
                                                Set by Role
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-3 mt-6">
                                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition-colors">
                                        <span id="user-submit-text">Add User</span>
                                    </button>
                                    <button type="button" onclick="hideUserForm()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg font-medium transition-colors">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Users List -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6">
                        <!-- Search and Filter -->
                        <div class="flex flex-col sm:flex-row gap-4 mb-6">
                            <div class="flex-1">
                                <input type="text" id="user-search" placeholder="Search users..." onkeyup="filterUsers()" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="flex gap-2">
                                <select id="role-filter" onchange="filterUsers()" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">All Roles</option>
                                    <option value="Admin">Administrator</option>
                                    <option value="Guard">Security Guard</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Head of Operations">Head of Operations</option>
                                    <option value="IT Support">IT Support</option>
                                    <option value="Accountant">Accountant</option>
                                </select>
                                <select id="status-filter" onchange="filterUsers()" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Name</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Employee ID</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Email</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Role</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Department</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Location</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Privileges</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Status</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Last Login</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table">
                                    <!-- Users will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section-content p-6 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">System Settings</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Alert Settings</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Email Notifications</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">SMS Alerts</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Auto-escalation</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">System Preferences</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Check-in Frequency</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option>Every 15 minutes</option>
                                    <option>Every 30 minutes</option>
                                    <option>Every hour</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Time Zone</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option>Eastern Time (ET)</option>
                                    <option>Central Time (CT)</option>
                                    <option>Mountain Time (MT)</option>
                                    <option>Pacific Time (PT)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Authentication System
        class AuthSystem {
            constructor() {
                this.users = this.loadUsers();
                this.currentUser = null;
                this.sessionTimeout = 30 * 60 * 1000; // 30 minutes
                this.sessionTimer = null;
            }

            // Load users from localStorage or initialize with default admin
            loadUsers() {
                const stored = localStorage.getItem('sss_users');
                if (stored) {
                    return JSON.parse(stored);
                }
                
                // Default admin user
                const defaultUsers = {
                    'admin@sagittariussecurity.com': {
                        id: 'admin-001',
                        employeeId: 'SSS-GH0001',
                        firstName: 'System',
                        lastName: 'Administrator',
                        email: 'admin@sagittariussecurity.com',
                        password: this.hashPassword('admin123'), // In real world, this would be properly hashed
                        role: 'Admin',
                        department: 'IT',
                        isActive: true,
                        canLogin: true,
                        privileges: ['dashboard_view', 'incidents_view', 'incidents_create', 'incidents_edit', 'guards_view', 'guards_manage', 'users_view', 'users_manage', 'reports_view', 'reports_export', 'settings_view', 'settings_manage', 'alerts_send', 'system_admin'],
                        lastLogin: null,
                        createdAt: new Date().toISOString()
                    }
                };
                
                this.saveUsers(defaultUsers);
                return defaultUsers;
            }

            // Save users to localStorage
            saveUsers(users = this.users) {
                localStorage.setItem('sss_users', JSON.stringify(users));
                this.users = users;
            }

            // Simple password hashing (in real world, use proper bcrypt or similar)
            hashPassword(password) {
                // This is a simple hash for demo purposes - use proper hashing in production
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                return hash.toString();
            }

            // Verify password
            verifyPassword(inputPassword, hashedPassword) {
                return this.hashPassword(inputPassword) === hashedPassword;
            }

            // Login function
            async login(username, password, rememberMe = false) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Find user by email or employee ID
                        const user = Object.values(this.users).find(u => 
                            u.email.toLowerCase() === username.toLowerCase() || 
                            u.employeeId.toLowerCase() === username.toLowerCase()
                        );

                        if (!user) {
                            reject(new Error('User not found'));
                            return;
                        }

                        if (!user.isActive) {
                            reject(new Error('Account is deactivated'));
                            return;
                        }

                        if (!user.canLogin) {
                            reject(new Error('Login access denied'));
                            return;
                        }

                        if (!this.verifyPassword(password, user.password)) {
                            reject(new Error('Invalid password'));
                            return;
                        }

                        // Update last login
                        user.lastLogin = new Date().toISOString();
                        this.saveUsers();

                        // Set current user
                        this.currentUser = user;

                        // Save session
                        const sessionData = {
                            userId: user.id,
                            loginTime: new Date().toISOString(),
                            rememberMe: rememberMe
                        };

                        if (rememberMe) {
                            localStorage.setItem('sss_session', JSON.stringify(sessionData));
                        } else {
                            sessionStorage.setItem('sss_session', JSON.stringify(sessionData));
                        }

                        // Start session timer
                        this.startSessionTimer();

                        resolve(user);
                    }, 1000); // Simulate network delay
                });
            }

            // Logout function
            logout() {
                this.currentUser = null;
                localStorage.removeItem('sss_session');
                sessionStorage.removeItem('sss_session');
                
                if (this.sessionTimer) {
                    clearTimeout(this.sessionTimer);
                    this.sessionTimer = null;
                }

                // Show login screen
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                
                // Reset login form
                document.getElementById('login-form').reset();
                hideLoginError();
            }

            // Check if user is logged in
            isLoggedIn() {
                const sessionData = this.getSessionData();
                if (!sessionData) return false;

                const user = Object.values(this.users).find(u => u.id === sessionData.userId);
                if (!user || !user.isActive || !user.canLogin) {
                    this.logout();
                    return false;
                }

                this.currentUser = user;
                return true;
            }

            // Get session data
            getSessionData() {
                let sessionData = sessionStorage.getItem('sss_session');
                if (!sessionData) {
                    sessionData = localStorage.getItem('sss_session');
                }
                
                if (sessionData) {
                    try {
                        return JSON.parse(sessionData);
                    } catch (e) {
                        return null;
                    }
                }
                return null;
            }

            // Start session timer
            startSessionTimer() {
                if (this.sessionTimer) {
                    clearTimeout(this.sessionTimer);
                }

                this.sessionTimer = setTimeout(() => {
                    alert('Your session has expired. Please log in again.');
                    this.logout();
                }, this.sessionTimeout);
            }

            // Reset session timer (call on user activity)
            resetSessionTimer() {
                if (this.isLoggedIn()) {
                    this.startSessionTimer();
                }
            }

            // Add new user
            addUser(userData) {
                const userId = 'user-' + Date.now();
                const hashedPassword = this.hashPassword(userData.password || 'temp123');
                
                const newUser = {
                    id: userId,
                    ...userData,
                    password: hashedPassword,
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };

                this.users[userData.email] = newUser;
                this.saveUsers();
                return newUser;
            }

            // Update user
            updateUser(userId, userData) {
                const user = Object.values(this.users).find(u => u.id === userId);
                if (user) {
                    Object.assign(user, userData);
                    this.saveUsers();
                    return user;
                }
                return null;
            }

            // Delete user
            deleteUser(userId) {
                const userEmail = Object.keys(this.users).find(email => this.users[email].id === userId);
                if (userEmail) {
                    delete this.users[userEmail];
                    this.saveUsers();
                    return true;
                }
                return false;
            }

            // Get current user
            getCurrentUser() {
                return this.currentUser;
            }

            // Reset password (would send email in real world)
            async resetPassword(username) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const user = Object.values(this.users).find(u => 
                            u.email.toLowerCase() === username.toLowerCase() || 
                            u.employeeId.toLowerCase() === username.toLowerCase()
                        );

                        if (!user) {
                            reject(new Error('User not found'));
                            return;
                        }

                        // In real world, send email with reset link
                        // For demo, we'll just show success
                        resolve('Password reset link sent to your email');
                    }, 1000);
                });
            }
        }

        // Initialize authentication system
        const auth = new AuthSystem();

        // Login form functions
        function togglePassword() {
            const passwordInput = document.getElementById('login-password');
            const eyeIcon = document.getElementById('eye-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            }
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('login-error');
            const errorText = document.getElementById('login-error-text');
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideLoginError() {
            document.getElementById('login-error').classList.add('hidden');
        }

        function setLoginLoading(loading) {
            const btn = document.getElementById('login-btn');
            const btnText = document.getElementById('login-btn-text');
            const spinner = document.getElementById('login-spinner');
            
            if (loading) {
                btn.disabled = true;
                btn.classList.add('opacity-75', 'cursor-not-allowed');
                btnText.textContent = 'Signing In...';
                spinner.classList.remove('hidden');
            } else {
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
                btnText.textContent = 'Sign In';
                spinner.classList.add('hidden');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            if (!username || !password) {
                showLoginError('Please enter both username and password');
                return;
            }

            hideLoginError();
            setLoginLoading(true);

            try {
                const user = await auth.login(username, password, rememberMe);
                
                // Login successful
                showMainApp(user);
                
            } catch (error) {
                showLoginError(error.message);
            } finally {
                setLoginLoading(false);
            }
        }

        function showMainApp(user) {
            // Hide login screen
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Set user info in UI
            const initials = (user.firstName.charAt(0) + user.lastName.charAt(0)).toUpperCase();
            const fullName = user.firstName + ' ' + user.lastName;
            
            document.getElementById('user-avatar').textContent = initials;
            document.getElementById('user-name').textContent = fullName;
            document.getElementById('user-role').textContent = user.role;
            document.getElementById('header-user-avatar').textContent = initials;
            document.getElementById('header-user-name').textContent = fullName;
            
            // Initialize the main app
            initializeMainApp();
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                auth.logout();
            }
        }

        // Forgot password functions
        function showForgotPassword() {
            document.getElementById('forgot-password-modal').classList.remove('hidden');
        }

        function hideForgotPassword() {
            document.getElementById('forgot-password-modal').classList.add('hidden');
            document.getElementById('forgot-password-form').reset();
        }

        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const username = document.getElementById('forgot-username').value.trim();
            
            if (!username) {
                alert('Please enter your Employee ID or Email');
                return;
            }

            try {
                const message = await auth.resetPassword(username);
                alert(message);
                hideForgotPassword();
            } catch (error) {
                alert(error.message);
            }
        }

        // Session management
        function resetSessionTimer() {
            auth.resetSessionTimer();
        }

        // Add event listeners for user activity
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);
        document.addEventListener('scroll', resetSessionTimer);

        // Initialize the system
        let incidentCounter = 3;
        let editingUserId = null;
        let userCounter = 0;
        let employeeIdCounter = 2; // Starting from SSS-GH0002 (admin is 0001)
        
        // Generate employee ID
        function generateEmployeeId() {
            const id = `SSS-GH${String(employeeIdCounter).padStart(4, '0')}`;
            employeeIdCounter++;
            return id;
        }
        
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleTimeString();
        }
        
        // Navigation functionality
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            document.getElementById(sectionName + '-section').classList.add('fade-in');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'incidents': 'Incident Reports',
                'guards': 'Guard Tracking',
                'users': 'User Management',
                'settings': 'Settings'
            };
            document.getElementById('page-title').textContent = titles[sectionName];
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-slate-700', 'text-white');
                item.classList.add('text-slate-300');
            });
            event.target.classList.add('bg-slate-700', 'text-white');
            event.target.classList.remove('text-slate-300');
        }
        
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        });
        
        // Incident form functions
        function showIncidentForm() {
            document.getElementById('incident-modal').classList.remove('hidden');
        }
        
        function hideIncidentForm() {
            document.getElementById('incident-modal').classList.add('hidden');
            document.getElementById('incident-form').reset();
        }
        
        function submitIncident(event) {
            event.preventDefault();
            
            // Get form data
            const form = event.target;
            const formData = new FormData(form);
            
            // Create new incident row
            const incidentId = String(incidentCounter + 1).padStart(3, '0');
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-gray-100';
            newRow.innerHTML = `
                <td class="py-3 px-4">#${incidentId}</td>
                <td class="py-3 px-4">${form.querySelector('select').value}</td>
                <td class="py-3 px-4">${form.querySelector('input[type="text"]').value}</td>
                <td class="py-3 px-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">${form.querySelectorAll('select')[1].value}</span></td>
                <td class="py-3 px-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">New</span></td>
                <td class="py-3 px-4">${new Date().toLocaleTimeString()}</td>
            `;
            
            // Add to table
            document.getElementById('incidents-table').insertBefore(newRow, document.getElementById('incidents-table').firstChild);
            
            // Update counter
            incidentCounter++;
            
            // Update stats
            document.querySelector('.text-red-600').textContent = incidentCounter;
            
            // Hide form
            hideIncidentForm();
            
            // Show success message
            alert('Incident reported successfully!');
        }
        
        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('incidentChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Incidents',
                        data: [2, 1, 3, 2, 4, 1, 2],
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // User Management Functions
        
        // Privilege management functions
        function selectAllPrivileges() {
            const checkboxes = document.querySelectorAll('input[name="privileges"]');
            checkboxes.forEach(checkbox => checkbox.checked = true);
        }
        
        function clearAllPrivileges() {
            const checkboxes = document.querySelectorAll('input[name="privileges"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);
        }
        
        function setRolePrivileges() {
            const roleSelect = document.querySelector('select[name="role"]');
            const selectedRole = roleSelect.value;
            
            // Clear all first
            clearAllPrivileges();
            
            // Define role-based privilege sets
            const rolePrivileges = {
                'Admin': [
                    'dashboard_view', 'incidents_view', 'incidents_create', 'incidents_edit',
                    'guards_view', 'guards_manage', 'users_view', 'users_manage',
                    'reports_view', 'reports_export', 'settings_view', 'settings_manage',
                    'alerts_send', 'system_admin'
                ],
                'Head of Operations': [
                    'dashboard_view', 'incidents_view', 'incidents_create', 'incidents_edit',
                    'guards_view', 'guards_manage', 'users_view', 'reports_view', 
                    'reports_export', 'settings_view', 'alerts_send'
                ],
                'Supervisor': [
                    'dashboard_view', 'incidents_view', 'incidents_create', 'incidents_edit',
                    'guards_view', 'guards_manage', 'reports_view', 'alerts_send'
                ],
                'Guard': [
                    'dashboard_view', 'incidents_view', 'incidents_create', 'guards_view'
                ],
                'IT Support': [
                    'dashboard_view', 'incidents_view', 'users_view', 'users_manage',
                    'settings_view', 'settings_manage', 'system_admin'
                ],
                'Accountant': [
                    'dashboard_view', 'reports_view', 'reports_export'
                ]
            };
            
            if (selectedRole && rolePrivileges[selectedRole]) {
                rolePrivileges[selectedRole].forEach(privilege => {
                    const checkbox = document.querySelector(`input[value="${privilege}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }
        
        // Auto-set privileges when role changes and show/hide location field
        document.addEventListener('change', function(event) {
            if (event.target.name === 'role') {
                setRolePrivileges();
                toggleLocationField(event.target.value);
            }
        });
        
        function toggleLocationField(role) {
            const locationField = document.getElementById('location-field');
            const locationInput = document.querySelector('input[name="location"]');
            
            if (role === 'Guard') {
                locationField.classList.remove('hidden');
                locationInput.required = true;
            } else {
                locationField.classList.add('hidden');
                locationInput.required = false;
                locationInput.value = '';
            }
        }
        
        function showUserForm(userData = null) {
            const modal = document.getElementById('user-modal');
            const form = document.getElementById('user-form');
            const title = document.getElementById('user-modal-title');
            const submitText = document.getElementById('user-submit-text');
            
            if (userData) {
                // Edit mode
                editingUserId = userData.id;
                title.textContent = 'Edit User';
                submitText.textContent = 'Update User';
                
                // Populate form
                form.firstName.value = userData.firstName;
                form.lastName.value = userData.lastName;
                form.email.value = userData.email;
                form.role.value = userData.role;
                form.department.value = userData.department;
                form.location.value = userData.location || '';
                form.phone.value = userData.phone || '';
                form.employeeId.value = userData.employeeId || '';
                form.isActive.checked = userData.isActive;
                form.canLogin.checked = userData.canLogin;
                
                // Show/hide location field based on role
                toggleLocationField(userData.role);
            } else {
                // Add mode
                editingUserId = null;
                title.textContent = 'Add New User';
                submitText.textContent = 'Add User';
                form.reset();
                form.isActive.checked = true;
                form.canLogin.checked = true;
                
                // Auto-generate employee ID for new users
                form.employeeId.value = generateEmployeeId();
            }
            
            modal.classList.remove('hidden');
        }
        
        function hideUserForm() {
            document.getElementById('user-modal').classList.add('hidden');
            document.getElementById('user-form').reset();
            editingUserId = null;
        }
        
        function submitUser(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Get selected privileges
            const selectedPrivileges = [];
            const privilegeCheckboxes = form.querySelectorAll('input[name="privileges"]:checked');
            privilegeCheckboxes.forEach(checkbox => {
                selectedPrivileges.push(checkbox.value);
            });
            
            const userData = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                role: formData.get('role'),
                department: formData.get('department'),
                location: formData.get('location'),
                phone: formData.get('phone'),
                employeeId: formData.get('employeeId'),
                isActive: form.isActive.checked,
                canLogin: form.canLogin.checked,
                privileges: selectedPrivileges,
                password: 'temp123' // Default password for new users
            };
            
            if (editingUserId) {
                // Update existing user
                auth.updateUser(editingUserId, userData);
                updateUserInTable(editingUserId, userData);
                alert('User updated successfully!');
            } else {
                // Add new user
                const newUser = auth.addUser(userData);
                addUserToTable(newUser);
                userCounter++;
            }
            
            hideUserForm();
        }
        
        function addUserToTable(userData) {
            const table = document.getElementById('users-table');
            const initials = (userData.firstName.charAt(0) + userData.lastName.charAt(0)).toUpperCase();
            const fullName = userData.firstName + ' ' + userData.lastName;
            const userId = userData.id;
            
            const roleColors = {
                'Admin': 'bg-purple-100 text-purple-800',
                'Guard': 'bg-green-100 text-green-800',
                'Supervisor': 'bg-yellow-100 text-yellow-800',
                'Head of Operations': 'bg-blue-100 text-blue-800',
                'IT Support': 'bg-cyan-100 text-cyan-800',
                'Accountant': 'bg-orange-100 text-orange-800'
            };
            
            const avatarColors = ['bg-blue-500', 'bg-green-500', 'bg-orange-500', 'bg-purple-500', 'bg-red-500'];
            const avatarColor = avatarColors[Math.floor(Math.random() * avatarColors.length)];
            
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-gray-100 user-row';
            newRow.setAttribute('data-role', userData.role);
            newRow.setAttribute('data-status', userData.isActive ? 'active' : 'inactive');
            newRow.setAttribute('data-user-id', userId);
            
            // Create privileges display
            const privilegeCount = userData.privileges ? userData.privileges.length : 0;
            const privilegeDisplay = privilegeCount > 0 ? 
                `<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${privilegeCount} privileges</span>` : 
                `<span class="text-xs text-gray-500">No privileges</span>`;
            
            newRow.innerHTML = `
                <td class="py-3 px-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 ${avatarColor} rounded-full flex items-center justify-center text-white text-sm font-medium">${initials}</div>
                        <span class="font-medium ${userData.isActive ? '' : 'text-gray-500'}">${fullName}</span>
                    </div>
                </td>
                <td class="py-3 px-4 ${userData.isActive ? '' : 'text-gray-500'}">
                    <span class="font-mono text-sm bg-gray-100 px-2 py-1 rounded">${userData.employeeId}</span>
                </td>
                <td class="py-3 px-4 ${userData.isActive ? '' : 'text-gray-500'}">${userData.email}</td>
                <td class="py-3 px-4"><span class="${roleColors[userData.role]} px-2 py-1 rounded-full text-xs font-medium">${userData.role === 'Admin' ? 'Administrator' : userData.role === 'Guard' ? 'Security Guard' : userData.role}</span></td>
                <td class="py-3 px-4 ${userData.isActive ? '' : 'text-gray-500'}">${userData.department}</td>
                <td class="py-3 px-4 ${userData.isActive ? '' : 'text-gray-500'}">${userData.location || '-'}</td>
                <td class="py-3 px-4">${privilegeDisplay}</td>
                <td class="py-3 px-4"><span class="${userData.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full text-xs font-medium">${userData.isActive ? 'Active' : 'Inactive'}</span></td>
                <td class="py-3 px-4 ${userData.isActive ? '' : 'text-gray-500'}">${userData.lastLogin ? new Date(userData.lastLogin).toLocaleString() : 'Never'}</td>
                <td class="py-3 px-4">
                    <div class="flex space-x-2">
                        <button onclick="editUser(this)" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Edit</button>
                        <button onclick="viewPrivileges(this)" class="text-purple-600 hover:text-purple-800 text-sm font-medium">Privileges</button>
                        <button onclick="toggleUserStatus(this)" class="${userData.isActive ? 'text-yellow-600 hover:text-yellow-800' : 'text-green-600 hover:text-green-800'} text-sm font-medium">${userData.isActive ? 'Deactivate' : 'Activate'}</button>
                        <button onclick="deleteUser(this)" class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</button>
                    </div>
                </td>
            `;
            
            table.insertBefore(newRow, table.firstChild);
        }
        
        function updateUserInTable(userId, userData) {
            const row = document.querySelector(`[data-user-id="${userId}"]`);
            if (!row) return;
            
            const initials = (userData.firstName.charAt(0) + userData.lastName.charAt(0)).toUpperCase();
            const fullName = userData.firstName + ' ' + userData.lastName;
            
            const roleColors = {
                'Admin': 'bg-purple-100 text-purple-800',
                'Guard': 'bg-green-100 text-green-800',
                'Supervisor': 'bg-yellow-100 text-yellow-800',
                'Head of Operations': 'bg-blue-100 text-blue-800',
                'IT Support': 'bg-cyan-100 text-cyan-800',
                'Accountant': 'bg-orange-100 text-orange-800'
            };
            
            // Update row data attributes
            row.setAttribute('data-role', userData.role);
            row.setAttribute('data-status', userData.isActive ? 'active' : 'inactive');
            
            // Update row content
            const cells = row.querySelectorAll('td');
            cells[0].querySelector('span').textContent = fullName;
            cells[0].querySelector('div div').textContent = initials;
            cells[2].textContent = userData.email;
            cells[3].querySelector('span').textContent = userData.role === 'Admin' ? 'Administrator' : userData.role === 'Guard' ? 'Security Guard' : userData.role;
            cells[3].querySelector('span').className = `${roleColors[userData.role]} px-2 py-1 rounded-full text-xs font-medium`;
            cells[4].textContent = userData.department;
            cells[5].textContent = userData.location || '-';
            cells[7].querySelector('span').textContent = userData.isActive ? 'Active' : 'Inactive';
            cells[7].querySelector('span').className = `${userData.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full text-xs font-medium`;
            
            // Update styling for inactive users
            const grayClass = userData.isActive ? '' : 'text-gray-500';
            cells[0].querySelector('span').className = `font-medium ${grayClass}`;
            cells[1].className = `py-3 px-4 ${grayClass}`;
            cells[2].className = `py-3 px-4 ${grayClass}`;
            cells[4].className = `py-3 px-4 ${grayClass}`;
            cells[5].className = `py-3 px-4 ${grayClass}`;
            cells[8].className = `py-3 px-4 ${grayClass}`;
            
            // Update action buttons
            const toggleBtn = cells[9].querySelector('button:nth-child(3)');
            toggleBtn.textContent = userData.isActive ? 'Deactivate' : 'Activate';
            toggleBtn.className = userData.isActive ? 'text-yellow-600 hover:text-yellow-800 text-sm font-medium' : 'text-green-600 hover:text-green-800 text-sm font-medium';
        }
        
        function editUser(button) {
            const row = button.closest('tr');
            const userId = row.getAttribute('data-user-id');
            const user = Object.values(auth.users).find(u => u.id === userId);
            
            if (user) {
                showUserForm(user);
            }
        }
        
        function toggleUserStatus(button) {
            const row = button.closest('tr');
            const userId = row.getAttribute('data-user-id');
            const currentStatus = row.getAttribute('data-status');
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            const isActive = newStatus === 'active';
            
            // Update in auth system
            const user = Object.values(auth.users).find(u => u.id === userId);
            if (user) {
                user.isActive = isActive;
                auth.saveUsers();
            }
            
            // Update row data
            row.setAttribute('data-status', newStatus);
            
            // Update status badge
            const statusCell = row.querySelector('td:nth-child(8)');
            const statusBadge = statusCell.querySelector('span');
            statusBadge.textContent = isActive ? 'Active' : 'Inactive';
            statusBadge.className = `${isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full text-xs font-medium`;
            
            // Update styling for inactive users
            const grayClass = isActive ? '' : 'text-gray-500';
            const cells = row.querySelectorAll('td');
            cells[0].querySelector('span').className = `font-medium ${grayClass}`;
            cells[1].className = `py-3 px-4 ${grayClass}`;
            cells[2].className = `py-3 px-4 ${grayClass}`;
            cells[4].className = `py-3 px-4 ${grayClass}`;
            cells[5].className = `py-3 px-4 ${grayClass}`;
            cells[8].className = `py-3 px-4 ${grayClass}`;
            
            // Update avatar color for inactive users
            const avatar = cells[0].querySelector('div div');
            if (!isActive) {
                avatar.className = avatar.className.replace(/bg-\w+-500/, 'bg-gray-400');
            }
            
            // Update button text
            button.textContent = isActive ? 'Deactivate' : 'Activate';
            button.className = isActive ? 'text-yellow-600 hover:text-yellow-800 text-sm font-medium' : 'text-green-600 hover:text-green-800 text-sm font-medium';
            
            alert(`User ${isActive ? 'activated' : 'deactivated'} successfully!`);
        }
        
        function deleteUser(button) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                const row = button.closest('tr');
                const userId = row.getAttribute('data-user-id');
                
                // Delete from auth system
                auth.deleteUser(userId);
                
                // Remove from table
                row.remove();
                alert('User deleted successfully!');
            }
        }
        
        function viewPrivileges(button) {
            const row = button.closest('tr');
            const userId = row.getAttribute('data-user-id');
            const user = Object.values(auth.users).find(u => u.id === userId);
            const userName = row.querySelector('td:first-child span').textContent;
            
            const privilegeLabels = {
                'dashboard_view': 'View Dashboard',
                'incidents_view': 'View Incidents',
                'incidents_create': 'Create Incidents',
                'incidents_edit': 'Edit Incidents',
                'guards_view': 'View Guard Tracking',
                'guards_manage': 'Manage Guards',
                'users_view': 'View Users',
                'users_manage': 'Manage Users',
                'reports_view': 'View Reports',
                'reports_export': 'Export Reports',
                'settings_view': 'View Settings',
                'settings_manage': 'Manage Settings',
                'alerts_send': 'Send Alerts',
                'system_admin': 'System Administration'
            };
            
            // Update modal content
            document.getElementById('privileges-modal-title').textContent = `${userName} - Privileges`;
            const privilegesContent = document.getElementById('privileges-content');
            
            const userPrivileges = user ? user.privileges || [] : [];
            
            if (userPrivileges.length === 0) {
                privilegesContent.innerHTML = '<p class="text-gray-500 text-center">No privileges assigned</p>';
            } else {
                privilegesContent.innerHTML = userPrivileges.map(privilege => 
                    `<div class="flex items-center space-x-2 p-2 bg-gray-50 rounded">
                        <span class="text-green-500">‚úì</span>
                        <span class="text-sm">${privilegeLabels[privilege] || privilege}</span>
                    </div>`
                ).join('');
            }
            
            // Show modal
            document.getElementById('privileges-modal').classList.remove('hidden');
        }
        
        function hidePrivilegesModal() {
            document.getElementById('privileges-modal').classList.add('hidden');
        }
        
        function filterUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const roleFilter = document.getElementById('role-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const rows = document.querySelectorAll('.user-row');
            
            rows.forEach(row => {
                const name = row.querySelector('td:first-child span').textContent.toLowerCase();
                const employeeId = row.querySelector('td:nth-child(2) span').textContent.toLowerCase();
                const email = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const role = row.getAttribute('data-role');
                const status = row.getAttribute('data-status');
                
                const matchesSearch = name.includes(searchTerm) || email.includes(searchTerm) || employeeId.includes(searchTerm);
                const matchesRole = !roleFilter || role === roleFilter;
                const matchesStatus = !statusFilter || status === statusFilter;
                
                if (matchesSearch && matchesRole && matchesStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Initialize main app
        function initializeMainApp() {
            updateTimestamp();
            setInterval(updateTimestamp, 60000); // Update every minute
            initChart();
            
            // Set default active nav item
            document.querySelector('.nav-item').classList.add('bg-slate-700', 'text-white');
            document.querySelector('.nav-item').classList.remove('text-slate-300');
        }
        
        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            if (window.innerWidth < 1024 && !sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
                sidebar.classList.add('-translate-x-full');
            }
        });

        // Initialize the system on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            if (auth.isLoggedIn()) {
                showMainApp(auth.getCurrentUser());
            } else {
                // Show login screen
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97afd29531279346',t:'MTc1NzE4MTE3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
